
<!doctype html>

<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Mobility Age ‚Äî v9.27</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:#fafafa;color:#111}
  .wrap{max-width:980px;margin:24px auto;padding:0 12px}
  .car{background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:16px}
  .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:18px}
  .row{display:grid;grid-template-columns:220px 1fr;gap:10px;align-items:center}
  input,select{font:inherit;padding:8px 10px;border:1px solid #e5e7eb;border-radius:10px}
  input[type=number]{width:100%}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{border-bottom:1px solid #e5e7eb;padding:8px;text-align:left}
  .note{font-size:12px;color:#666}#dbg{display:block;background:#eef2ff;border:1px solid #c7d2fe;color:#1e3a8a;padding:10px;border-radius:10px;margin-top:8px;white-space:pre-wrap}
  #err{display:none;background:#fee2e2;border:1px solid #fecaca;color:#7f1d1d;padding:10px;border-radius:10px;margin-top:10px;white-space:pre-wrap}.toolbar{display:flex;gap:8px;margin:8px 0}
  .btn{background:#111;color:#fff;border-radius:10px;padding:8px 12px;border:none;cursor:pointer}
  .btn:active{transform:translateY(1px)}
</style>

<!-- Injected creative theme [SENIOR THEME] -->
<style>

:root{
  --bg: #ffffff;
  --panel: #ffffff;
  --ink: #0b141a;
  --muted: #2b3a44;
  --accent: #0052cc;
  --accent-ink: #ffffff;
  --border: #cbd5e1;
  --focus: #99c2ff;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: Segoe UI, system-ui, -apple-system, Roboto, Helvetica, Arial;
  color: var(--ink);
  background: var(--bg);
  line-height: 1.6;
  font-size: 18px;
}
header{
  position: sticky; top:0; z-index: 50;
  background: #f8fafc;
  border-bottom: 2px solid var(--border);
  padding: 1rem 1rem;
}
header h1, header h2{ margin:0; font-weight:900; letter-spacing:.2px }
main{ max-width: 980px; margin: 1.25rem auto 2.25rem; padding: 0 1rem }
section, fieldset{
  background: var(--panel);
  border: 2px solid var(--border);
  border-radius: 20px;
  padding: 1.25rem;
  margin: 1rem 0;
}
label{ display:block; font-weight: 900; margin: .8rem 0 .4rem; font-size: 1.05em }
input[type=text], input[type=number], select{
  width: 100%;
  background: #fff;
  color: var(--ink);
  border: 2px solid var(--border);
  border-radius: 14px;
  padding: .9rem 1rem;
  outline: none;
}
input:focus, select:focus{
  border-color: var(--accent);
  box-shadow: 0 0 0 4px var(--focus);
}
input::placeholder{ color: #64748b; opacity:.9 }
button{
  appearance:none;
  border: 2px solid var(--accent);
  background: var(--accent);
  color: var(--accent-ink);
  font-weight: 900;
  padding: .9rem 1.2rem;
  border-radius: 999px;
  cursor: pointer;
  font-size: 1.05em;
}
button.secondary{ background: #fff; color: var(--accent) }
button:disabled{ opacity:.6; cursor:not-allowed }
table{ width:100%; border-collapse: collapse; font-size: 1.02em }
th,td{ padding: .8rem .6rem; border-bottom: 2px solid var(--border) }
th{ text-transform: none; font-weight: 900 }
.badge{
  display:inline-block; padding:.35rem .7rem; border-radius:999px; background:#e6f0ff; border:2px solid var(--accent); color:var(--accent)
}
.grid-2{ display:grid; grid-template-columns: 1fr; gap:1.2rem }
@media (min-width: 820px){
  .grid-2{ grid-template-columns: 1fr 1fr }
}
.output, .readout, .big-number{ font-size: 1.35em; font-weight: 900; }
@media print{
  header, button{ display:none !important }
  section, fieldset{ border: 1px solid #000 }
}

</style>

<style>
/* --- Branding Bar --- */
.brandbar{
  display:flex; align-items:center; gap:12px;
}
.brandbar img{
  height:42px; width:auto; object-fit:contain; border-radius:8px;
}
.brandbar .company-name{
  font-weight:900; letter-spacing:.2px; font-size:1.15rem;
}
/* Print: keep brand visible at top of first page */
@media print{
  .brandbar img{ height:36px }
  .brandbar .company-name{ font-size:1rem }
}
</style>

<style>#ok, #hb { display:none !important; visibility:hidden !important; }</style>
<style>#dbg{display:none !important}</style>
  <meta name="version" content="v9.27">

<script>
document.addEventListener('DOMContentLoaded', function(){
  var meta = document.querySelector('meta[name="version"]');
  var ver  = (meta && meta.content) || document.body.getAttribute('data-app-version') || 'v9.27';
  var t = document.title;
  if (!/v\d+\.\d+/.test(t)) {
    document.title = t.trim() + ' ‚Äî ' + ver;
  } else {
    document.title = t.replace(/v\d+\.\d+/, ver);
  }
});
</script>


<style>
@media print{
  header, .no-print, .toolbar, button, .btn { display: none !important; }
  section, fieldset, .card { border: 1px solid #000 !important; box-shadow: none !important; }
  input, select, textarea { border: 1px solid #000 !important; background: #fff !important; color: #000 !important; }
  table { width:100% !important; border-collapse: collapse !important; }
  th, td { border: 1px solid #000 !important; padding: 6px 8px !important; }
  @page { size: Letter portrait; margin: 12mm; }
  *, *::before, *::after { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
  .avoid-break, table, tr, td, th, .card { page-break-inside: avoid !important; }
  main, body { width: auto !important; margin: 0 !important; }
}
</style>


<style>
@media print {
  header, .brandbar, .no-print, .toolbar, #dbg, #err { display: none !important; }
  main h1 { font-size: 16pt !important; margin: 0 0 .35rem !important; }
  main h2 { font-size: 12pt !important; margin: 0 0 .25rem !important; }
  .note { display: none !important; }
  main > :is(p, .readout, .output, .summary, div, section, fieldset):first-child {
    break-after: avoid-page !important;
    page-break-after: avoid !important;
    margin-bottom: .25rem !important;
  }
  body, main { margin-top: 0 !important; padding-top: 0 !important; }
  section, fieldset, .card, table, tr, td, th { break-inside: avoid !important; page-break-inside: avoid !important; }
  section, fieldset, .card { border: 1px solid #000 !important; box-shadow: none !important; }
  table { width: 100% !important; border-collapse: collapse !important; }
  th, td { border: 1px solid #000 !important; padding: 6px 8px !important; }
  @page { size: Letter portrait; margin: 10mm; }
  *, *::before, *::after { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
}
</style>


<style>
@media print {
  /* Show header + brandbar; hide only toolbar/controls */
  header { display:block !important; padding: 0 0 6px !important; border:0 !important; background:none !important; }
  .brandbar { display:flex !important; align-items:center; gap:8px; margin: 0 0 6px !important; }
  .brandbar img { height:28px !important; width:auto !important; border-radius:6px !important; }
  .brandbar .company-name { font-weight:900 !important; font-size: 11pt !important; letter-spacing:.2px !important; }
  .no-print, .toolbar, button, .btn { display:none !important; }

  /* Keep title with next content; keep brand with title */
  h1, main h1, .brandbar {
    break-after: avoid-page !important;
    page-break-after: avoid !important;
    margin-bottom: 6px !important;
  }

  /* Pull first substantive content up to same page as title/brand */
  #controls, #inputs, #final, #results, #summary, section, fieldset {
    break-before: avoid-page !important;
    page-break-before: avoid !important;
    margin-top: 0 !important;
  }

  /* Tighten overall top spacing */
  body, main { margin-top: 0 !important; padding-top: 0 !important; }
}
</style>


<style id="print-results-pagebreak">
@media print{
  /* Force Results table onto its own printed page */
  #results{ 
    break-before: page !important; 
    page-break-before: always !important; 
  }
}
</style>

</head>
<body data-v='v10' data-app-version="v9.27">


<!-- print cover (print-only) -->
<div id="print-cover" aria-hidden="true" style="display:none">
  <div class="print-cover-brand">
    <img id="print-cover-logo" alt="Healthspan logo">
    <div class="print-cover-titles">
      <div class="print-company">HEALTHSPAN</div>
      <h1 class="print-title">Mobility Age Report</h1>
    </div>
  </div>

  <div class="print-meta" aria-hidden="true">
    <div><span class="k">Member</span><span class="v" id="printMember">‚Äî</span></div>
    <div><span class="k">Test date</span><span class="v" id="printTestDate">‚Äî</span></div>
    <div><span class="k">Location</span><span class="v" id="printLocation">‚Äî</span></div>
    <div><span class="k">Tester</span><span class="v" id="printTester">‚Äî</span></div>
  </div>

  <p class="print-intro">
    The Healthspan Mobility Index combines six mobility-related tests into a single calculated mobility age score, your HSMI.
    It answers the question: ‚ÄúHow does my calculated Mobility Age compare to my actual age and the mobility of many thousands of others of my age and gender?‚Äù
  </p>
</div>

<script>
(function(){
  function ready(fn){
    if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', fn);
    else fn();
  }
  function fmtDate(iso){
    if (!iso) return '';
    try{
      var d = new Date(String(iso) + 'T00:00:00');
      return new Intl.DateTimeFormat('en-US',{year:'numeric',month:'long',day:'numeric'}).format(d);
    }catch(e){ return String(iso); }
  }
  ready(function(){
    function update(){
      try{
        var logo = document.querySelector('.brandbar img');
        var tgt  = document.getElementById('print-cover-logo');
        if (logo && tgt && !tgt.getAttribute('src')) tgt.setAttribute('src', logo.getAttribute('src') || '');

        var first = (document.getElementById('firstName')||{}).value || '';
        var last  = (document.getElementById('lastName')||{}).value || '';
        first = String(first).trim(); last = String(last).trim();
        var member = (first || last) ? (first + (first && last ? ' ' : '') + last) : String(((document.getElementById('memberName')||{}).value)||'').trim();

        var td = fmtDate(((document.getElementById('testDate')||{}).value)||'');
        var loc = String(((document.getElementById('location')||{}).value)||'').trim();
        var tst = String(((document.getElementById('tester')||{}).value)||'').trim();

        function set(id,val){
          var el = document.getElementById(id);
          if (!el) return;
          el.textContent = val ? val : '‚Äî';
        }
        set('printMember', member);
        set('printTestDate', td);
        set('printLocation', loc);
        set('printTester', tst);
      }catch(e){}
    }

    update();
    ['firstName','lastName','memberName','testDate','location','tester'].forEach(function(id){
      var el = document.getElementById(id);
      if (!el) return;
      el.addEventListener('input', update);
      el.addEventListener('change', update);
    });

// Refresh right before printing and catch late-injected fields (e.g., First/Last patch)
window.addEventListener('beforeprint', update);
var tries = 0;
var timer = setInterval(function(){
  tries++;
  ['firstName','lastName','memberName'].forEach(function(id){
    var el = document.getElementById(id);
    if (!el || el.__PRINT_COVER_BOUND__) return;
    el.__PRINT_COVER_BOUND__ = true;
    el.addEventListener('input', update);
    el.addEventListener('change', update);
  });
  if (tries >= 10) clearInterval(timer);
}, 400);
  });
})();
</script>
<header>
<div class="toolbar no-print" role="toolbar" aria-label="Actions">
  <button id="btnPrint" class="btn" type="button"
          title="Print this page (Ctrl/Cmd+P)"
          onclick="try{document.activeElement&&document.activeElement.blur&&document.activeElement.blur();window.print()}catch(e){}">
    üñ®Ô∏è Print
  </button>
</div>

<div class="brandbar no-print">
  <img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/2wBDAQMEBAUEBQkFBQkUDQsNFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBT/wAARCAEBAgEDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD9UKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACikJxWB4v+IHhzwDYi78Q6xaaVA33TcSAM/wDur1P4VcISqSUYK7ZnUqQpRc6jSS6vQ6CivNNF/aS+GuveeLXxZZBoY2ldZi0Z2qMkgMBnA9Kw9B/bI+DXiTWE0yy8eaaLqRtifaN0SM2cYDMAP1rplg8TG/NSkreTOanjsLVScKsWn2aPZ6KbHIk0ayRsHRhlWU5BHYg06uM7QooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiivK/wDhZHjPxB4m8T2fhXw1o+oaXoV8umvdahqslu9xOIIpZAqrC4AUyhMk9VPpQB6pRXj2gfHi8+IVnpdv4O8PC71u4tjc38eo3XlW2lqsrwkSSKrF2Z4pAqoPmC7iVBGWa18ddW8GR6xYeI/DUUOv6ctndJHY3ZktryznuVtzPG5UFTGzfMjDIypBIbNAHslFee+JPi0mi/Fjw54Kg05rs6irtd33mbUsyUdoUIx8zSeXJgcYCE1g+IPjhqi+KH0Hw3oFtq11JrC6JazXV4YIpZktpLm6YkIxCRKiqcAks+KAPYKK8k8S/Ejx74L0Y3eseF9Da4urm3sNOt7LVpZPOuZpVRVcmAbVALMSMnjpVr/hZ/iXwv4h03T/ABn4f0vTrPUkuDBfaXqjXAjaGIysJEeJCAVVvmBOCORzmgD1GivJvBvjz4l+M9A0XXYfCPh+z03VIIruNLjWZfPjhkAZSyiAjdtIOM9eM1Q0/wCMnjbWPDN94t0vwVp2p+F4ZLloVj1hkvp7eGR1MiRmHYWYIWClxnIGaAPaKK5+Hxxpl14CTxfby+Zo8mnf2pHKRjMJj8wH/vmvNYfjN410jwponivxH4N0y08P6l9jMi2WrPJeWwuWRUzE0Ch2UyDcoYHrjOKAPaqK89tvjFp1jY+M5vEKDRpfC14YLqPJkMsTgPbSxgDLearKAoBO8MoyRXUeDdW1TXPDtnqGsaV/Yd7cAyHT2lEjwoSdiuRxv243AZAJIycZoAwvjJ8TLP4R+AtQ8RXaCZ4gI7a3zjzZm4Rfp3PsDXg3wj/Z9vPizMPiH8VpZdUub4CWz0mRisccR5UsB0XB4QY465ra/bstTH8PdA1e6cDQ9L1RbjUVYgDy9hAPueqgdy4rkfA3jT9oj47alpfinwxBovw9+H8UivZWOrIZZtRhBwN4A3bSB1G3sRkV9ZhVLD5equHmoym2pSbs0ltFdbvfQ+LxUFjczdPFQcqdNLlja6be8n0dttTjfhn8NLH9qT4jfETV9MtbHwx4D0WQ6ToiaXZpC810n/LwXABI4yR0IYDgjNdB8KfgD8PPjx4L8R+GPFvhSx0/xjoF21ndaxpcItriQsTsmZlADtlWzuBzjPevrfwn4J0fwemoNpOm2+mPqVy19eJajaklwwAdwO2cVxPxF8E+MLKxmPwyk0fQ768u3v8AULi8jYvdSntnBAB7k+gAxULNZ170FPlWnK2/htvd7u/XzNZZTDCyjioQ5nZ88UviT2stEmn+B85fAnxv4s/ZX+NVp8EvHmoPq/hXVjnw1rUpPylj8seT/CT8pX+FiMcNX3CDmvzr/aO8Y+KfiR4x+EvhPxD4bGkfEPT/ABNFsa2bieAlSZUIyQoKgkgkcZ7V+ia1yZrScHTqTSU5J3ts7faVu56WVYiNaM4wvyp6XTTXk79jzDxr8UdaXx5F4K8GaXa6priWwvL64v5THb2cROF3bRkscjj3FXvhn4+17xBr2v8Ah3xNpVrp+s6OInaWwnMsEySAlSMgEHjpXHfCZlm/aJ+LjysTOv2NEyc/JtP+C16t4r0q3uPD+q41JvDzzQ4l1e3KJLCo53b2GOBkc9MmvDdloe2rvU3qK+Ubfxdovhj4oeBoPBfjzWvEa6jqK2Op2+oXU11bSRvxvVmGwHPPyn07Vs+K7xvEHxe8U6H4o8Xat4SkjijHhmOC8aztZiUJLlhxI2/blSfUUcouY9t8XfECx8H634Z0u6hmluNevDZ25jA2owXcS2e2K5LxR4y8V+GfjJ4U0Z7jTZvDfiCSdI4Vt3FzF5Uascvuwclh0HavMvil8PtVj8UfCKDVvFep3Op3d2LSe4t5QEjkWEbpoRj5Wbua6bxR4Zbwn8WPg/Yvqt/rLfa9SkN1qUokl5ij4yAOBVWQrs98or5g1r4h6H43+Ini2y8V+ONQ8LaXot1/Z+n2Gl3Mls0rL/rJ3dBlueACcYrv/wBmnx1eeLvDWtWN7qb62+i6jJZw6pIpDXVv1ic8cnb1qeV2uUpJsueLvilrtx4/fwX4J0q01HVbW3W61G81CZktrVG+6vyjLMfStP4W+Pta8U6n4k0TxFpdtputaDLDHO1lOZYJhKm9GUkAjjsfWuL+Br+b8b/jS7uXlF/aoM9kCyYH866T49eKL7wX4RiHh/y7TXte1C30uG88sZjaRtu8+pUdM07a2FfS56jRXzt8SPDup/AvTtI8U6V4q1/U4/t0Nnqlrql81wlxFKSpZA3EbhuRt9fao/h/4R17xf4u8c+G9U8d+IJND0O/SKJIbgRXMu+PPzTAbgox0GOSaVtLj5tbH0bRXzf4QOtal8L/AIk6PL4n1dbjwrql5HZaos/+kukKMyI7HO4ZHNZ9x4a8Qa1+z43j6/8AHOvnxBbaSdQthaXJgt08tSQrRr9/IXkt1JNHKLmPqCsbxdHrcmg3P/CP3VnZ6ooDRy30LSxAA5bKqQeme9eL6h4n1j4m+KfA3g1dWutGs7zQl1vVrjTpPLuJ8jasauOUBIJJGOoq9oUupfDD4xJ4LfWNQ1nw9relzXtn/ak5nmt5oz86iQ8lSDnmjlDmMS6+NXjmb4B6P8QLSXR45hL5d9by2rsJA06xJ5fz/LjJJzmvomzkaa0gkf7zxqxx0yRmvkiH/kxm2/6+YP8A0uSu88QWOqeG/jd4NFz4n1oeG/ECPstUucRxXaAMseMf6tl42+xqrXEmz6Aorw2ytNU1v9pTVbO18Saumh6RaQ3t1Zi4zC1xI2ViAxwm0ZK+9e5VD0LTuFFFFIYUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAjMFUs3AHJrwf4T/Bf+2vBZ1jXdU8VaVqfiC7u9WvtOt9Ynto0a4mdxGYkYBcIUUgele80UAeD+G/7K/Z98eeKra90y607wzqy2cmlXtjZy3EEaxQiJrd9gYowI3DI+beTnOaxPiBous/EbS/HfjqLRb6zgh0SLTdDs5oCt7eJHcrczTGI/ModkjVFPJCEkDcK+k6KAPm/xbpHirQ/APh7xfDoE2qeNtR8Sw6xdadHy0DS280EELHtHCskKsenyu3eqPiTwXpXhXxp4G0PX4NcvNG0TRLu7k1PTILjN1qdzMglkd4eQxCStg8Ylr6eooA+dtU8E6T491TwHo2hjxLaeH11S51a9vZLm6guIpIICkSiST51y8qkAEZCt71zPxa8Caj4T1Lx3HpkPiLxDFc+EltbW/1CWbUZbWa4ufs8v2dmJYERPvZR2QGvq+igD56tv+EO0HQ9Sn8I2PiuXWNN0u4ewtrkX/llkhIRQsnyk9AB+VP8P+MJ7P4N6R4H8IaHq9/4lbSU05HutPltrW1kaPa880jqAERizYGS2MDrX0FRQB4t8XvC7eD/ANmN/BmlxXl3CNPs/DubSJpJRbM0cE0mFBPywmRunauOk8J+G9U8VeC/+EI0nxNLqOnarbzyTaot39htrNTibeLg7CSnCYBYPtIxgmvpqjr15oA8g1b4f23ib9pS01m702ZrDSNBjk81twt7m7a4fyCw+67woJiM8r52fSvXxxRRQB8e/wDBSa6lg8E/D2O63f8ACNyeJof7U/ulApIDe2PMP1ArsNF+FPxN+HeqQn4feL7PUfBt9KJhb6yvmG0jfncn94YxjaRnjjvXq3xw+Eel/HD4a6v4S1U+VHdpuguQMtbzKcxyD6Ht3GRXyL8Jv2lvEf7Jt4nwv+Nmn3n9lWf7vSPEdtG0yPBnCj/bQDGCPmXoR0r6fCVqlTB+xw6UpRveLSd0+qv1XlqfL47C0niva124p2tJNqz7O3R+Z9qeC/HGk+OLW8k0i/j1KOxuGs57iIYRpVA3bfUc9uK8m+InxC8afErRNSi+Buv6I+u6LqT6ZrFnq0ILwsDjepJwMYJGQQw6cjFfPvhX9orRPhJrPjhPh5qVl4s8M6ruutPZC8Y0+7YHakqsoYJnjIGCAO+a1P2dfiv4J/Z5+FGoXeoav/wlHxB8RXcmpanBp8T8zN92MuygbVyeRnlmxW0snq0ZOpQg5p8vKrXvffmXS3yOOnn1CcPZ4qoqco35tbWtty979LXMPxZ8HNc+D/j3wP4i8QeLp/FvxW17VojPdL/q4IFdR5UIPO0sQCcAEZGAM5/QNTnmvmL4H/DXxN8SviEPix8QoGtZVXGj6TIpHkrztbafuqATjPJJLHtX0/XHm9VN06DkpSgnzNbXb2XktjrySnUk62KcXGFRrlT3slu/OW54h4s8O+Ivh18Y5/Hnh/RJ/Eek6xaLaarptiyi4SRMbJUViA3AHf19a5fx1oXxE+Kfh/xhdnRtQ0/SpXsmsPDuoTIJZ1ifMy7VJC7xjvzivefEnir/AIR+4tIVsZr6W4V2VYQSQFKg9Af7w64HHWsiL4mW8mpajanTLlVsxc5l/hbyQNwBIxznsT05xXgps+ma8zyLxo3i3xdc+DNT0b4bX+l6Z4Z1SK9ewuHhguJuMFYo1JG0AfeJ5yOOtaPjLWPE/iDT/E2g+J/hlqHiWG6mkOjzW8UBihhdB5YkfflHVsksMmvWbrx/Y2El6txC0LWSSPc7mAESqQEJ/wB/Py/RvSjTPG/9s2+lzWWn+ct47RSf6Qn7iRM71OMhsYPI60XfYXL5nj+vfD/xd4b8E/CW7axn8S6p4UuxLf2lrIGmZGUjCFiA2wYXrzipvGmqeLPEXiTwL4zTwDrMVtod9dJLpuYmvHikiQLJsDYHIYY3dh617R4d8SL4ga722stukEzwhpARv2uy5GQB/D2J61lSfEiy+wzXEdndOYoZZWQxMv3JRHgEj5sk5+XNK5VjynSbPxD8NfGWvayvga/8ReHvFMi6n9nto4mvdPuCv7yORGYDGfQ9h71698P9U1DWtHlvNR8Mt4VkeUiOzkdGkaMAbWcJwrHn5e1R6h8QrHSp9Ihu4/Jl1A8q7hTCuQoYhsE5YqMAZ59jUuo+Nfseh3epQ6e1yltdNayRiVUORII9wz2yRRuCVjzTXtC8R/C74xan4y0LQLnxLoPiC3ji1Kx09l+0QzJ92RVYgMCM9+59q53xL4P+IPxUsfEetPY3WitbX9lqPh3R9TnTejwD94CFOE3kZ5PU/jXuI8aWw1SXTprWeO7jnht2ARmjzIitneBt43eueKTUPGAsfEi6SmnXFy22J5JohlUVy4yeMADYSckdeM0XZPKu55F40m8V/HK00bw9J4L1Twzp0N5FfapdamYwCsXzeVBtYlyzdCcdver/AMG/+Eos/iR4xvNV8H6jpNj4hulu47meSIrAEjI2vhiSSfSu3X4tabcae91bW0lyVvEtFjicOzK+dkmFycEAnGM+1aOneNpdShsJ49KkS2urWS73yTKGjVCoYFcZzlhT1taw1a97njWnaf4v8KwfFfTk8F6jqKa/qV5NZ3NvJEEZJQyKcFs8ZB+lbWgaD4k1L9mXV/Cl14du9M1m30eXToYJ3Q/aXMZwyYPAycc12kXxfsri1jlTTbjzykBkt8gvGZWwoIUEnjDZA5BFas/j6K31i00+SwmDTmIGXkKpdCwBJXGRjoSD7UXfYVkup4vpuh+L/DWqeCvG8PhC+nm03SjoOqaMrxm5aNeUni+bDAkngkcAV1nhvQdd+IXxW/4TfVtDuvDmm6Zpsmn6bZaiV+0SSSHMkrKpIUAYA55r0fwv4sTxNJdRizls3twjFJupDFgOw/unkZHoasWXiWG9toZlhZRJezWWCRw0ckiFj7Exk/iKXMNRR802HhHxdcfs96l8OJPCWp2+racRcR3cgT7NdmO6STZEwbJZlBxkDpXf/EC11f4nfCP7dbeHtQ8P+IdBuob6xtdUCJI8kO1iQQxG1gWXkg8GvUo/Ewm1iayisy0UMywSztKq4cpu4U8sOnT1rlPHvw18TeLry/Sw8c3WkaLqUSwXWnC0jk2Jt2t5LnBUsOv1NPmDlMf9m5Zde0PxB42uoWhufE+qSXSK/wB5YE/dxL+AUj8K9grO8O6DZ+FtCsNI0+PyrKxgS3hX0VQAM+prRqXq7lJWQUUUUhhRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUZqvd6ha6eoa6uYbZTwDNIEB/M0A9NyxRVe01G01BWa1uoblV6mGQPj8jU4bNAt9haKM0ZoGFFFFABRRRQAUUmaWgAooooAKKKKACiiigArH8UeD9D8baa2neINIstZsG5NvfQLKmfUBhwfcc1sUU02ndOwmlJWaOE8N/Av4e+DxdDRvBmi6f8Aak8ucx2SEyL/AHSSCdvt0q1o/wAHvBHh+/W+07wppNreKcrMlqu5TnORkcH6V2GRRkVt7etr77131ZzvC0JNN01ptotPQWiiisDpGNCjSLIVHmKCofHIBxkZ/AflVdtJsmLFrWAli5J8tf4+H7d8c+tWiwXrS/hQBUfSrSSaSZraFpZCheQxqWYocqScc4PT07U9LGCOQyLDGshbeWCAEtjGc+uABn0FWOfSjn0oAq2ml2lg0rW1tDbtKxaRoowpckkknA5OSfzpJNJspoTDJawyRFShjeNSu0nJGMdCQD+FW+fSjn0oApx6PYxwvEtnbiORBG6iJcMozhSMcjk8e5pi6Dp0fnbLG2Xzm3S4hX94c5y3HPPPNX6KAIfscPmM/lJvZg7NtGSwAAJ9wAPyoa0hczFoo2MyeXISoy6jPB9RyevqampCcUAVm0u0eSORraFpI9oRjGuV2klcHHGMnHpmlj062hRUjt4o0VWRVVAAFY5YD2J61Z59KOfSgDOk8O6XMMSadaSDaifNAh+VPuL06DJx6Zqwmm2saBEt4lUFSAEGPl+7+Xb0qzz6Uc+lAGfa+H9NsZVltrG3t5FbcGhiVDnBGeBzwzfmaT/hHdL2yqdOtSsz+bIvkLh3JJ3NxycknJ9TWgWC9aWgCkui6et1HcixthcxqFSbyV3qAMABsZAxxV2iigAoqOe5itYmlmlSGJRlnkYKo+pNZ3/CWaH5mz+2dP3/AN37VHn8s00m9kK6W5q0VHb3MN5CssEqTxN0kjYMp+hFSUhhRRmkyKAFopMijNAC0UUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAITgZr5s/aO/bf8ACXwQln0XT4/+Em8WJw1jbybYbZv+m0nY/wCyMn6Vgft1ftST/B/QIvCXhm58vxZq8JaS5Q/NYW543j0duQvoAT6V+XU00lxNJLNI000jFnkkYszMeSST1Jr6/KMlWKisRiPh6Lv/AMA+ezDMnQbpUvi6vse3fEj9tD4s/EqaUT+Jp9DsHyBYaKTbRhfQsDvb8Wx7V45e65qWpStJd6jd3UjHczTTuxJ9eTVGivvqWHo0Fy0oJLyR8lOtUqO85Nl2z1rUdPkWS11C7tnU7laGd1II78GvX/hz+2T8WfhrNGLXxTcaxYpjNjrR+1REegLfMv8AwFhXidFOrh6NZctSCa8whWqU3eEmvmfqF8Kf29vDXxZ8K6tpepj/AIQ/xkNPuGt0eXME8giYjyZDjDZGQrYPpmvgtf2nvi2QCfiN4jz/ANhCT/GvMaK87DZVhsLKbhG6l0etvQ7K2YV6yipOzXbqen/8NPfFr/oo3iT/AMGEn+Nbfgf9pL4q6h448OW1x8QfEM1vNqdrFJG9/IVdWmUMpGeQQSK8Vrofh3/yULwr/wBha0/9HJXXUwtDkl+7W3ZHPGvVcleb+8/drpRRRX4ufpR+Qfxi/aO+KOj/ABY8Y2Nj4+161s7bVbiKGCK9dUjRXICgZ4ArkP8AhqD4t/8ARRfEX/ge/wDjWR8dP+S0eOv+wzdf+jDXDV+y4fDUPYwfs1sui7H5xVrVVUklN7vqeof8NQfFv/ooviL/AMD3/wAaP+GoPi3/ANFF8Rf+B7/415fRW/1Wh/z7X3Ix9vV/nf3np/8Aw098W/8Aoo3iP/wYSf40f8NPfFr/AKKN4k/8GEn+NeYUUfVaH/Ptfch/WKv87+89P/4ae+LX/RRvEn/gwk/xo/4ae+LX/RRvEn/gwk/xrzCij6rQ/wCfa+5B9Yq/zv7z0/8A4ae+LX/RRvEn/gwk/wAaT/hpz4tf9FG8Sf8Agxk/xrzGij6rQ/59r7kL29X+d/eem/8ADTnxa/6KN4k/8GMn+NH/AA058Wv+ijeJP/BjJ/jXmVFH1Wh/z7X3IPb1f5n959h/sT/HL4heNP2iNB0nX/Getavpk0Fyz2l5ePJGxEZIJUnHBr9OK/Iz9gM4/ag8M8/8sLr/ANFGv1zr864gpwp4tKCsuVbfM+xyiUpYduTvqz5S/wCCk11NZ/s/20kE0kEn9sW43ROVOMPxkV+YH9van/0E73/wJf8Axr9Ov+Cl3/Jvdt/2Gbf+T1+W1fTcPRTwWq6v9Dxc3k1idOyL/wDb2p/9BK9/8CX/AMaP7e1P/oJXv/gS/wDjVCivpuWPY8Tmfcv/ANvan/0Er3/wJf8Axo/t7U/+gne/+BL/AONUKKOWPYOZ9z6S/Yu/aSufg78To7HXNQmk8K66yW14biUsLaTOI5uTwATg+x9q/WeNxIgZSCpGQQcg+9fgNX6g/wDBPz9oo/EjwOfBOt3O/wAReH4gLeSRvmubMcKfdk4U+22viOIMv0+t0l/i/Rn02UYzX6vN+n+R9dV5h+09I8P7Pvj943aORdImKspIIOOoIr0+vLv2ov8Ak3n4gf8AYIn/AJV8Xh/40PVfmfSVv4UvRn4xrr2p4H/Ezvf/AAJf/Gl/t7U/+gle/wDgS/8AjVBegor9r5Y9j815n3L/APb2p/8AQSvf/Al/8aP7e1P/AKCV7/4Ev/jVCijlj2Dmfc+hP2INWvrr9pzwfHNfXU0ZabKSTMyn903Ymv13r8fv2Gf+ToPB3+9P/wCimr9bPFPibTvBvhvUtc1e4W003T7d7m4mb+FFGT+PYDuSK/N+Io/7XFRX2V+bPssnl/s8m31/QzfiJ8SvDnwq8MXOv+J9Ti0zTYON7nLSN2RFHLMfQV+efxo/4KReLfFFxcWPgC2XwvpWSq31wiy3sg9QDlY/yJ9xXhn7RX7QGt/tBeOrjV7+SS20eBmj03S93yW8WeCR0LsOWP4dBXlde7luRUqMFUxK5pPp0X+bPLxmaTqScKLtH8WdB4m+Ifinxndtc694j1TV52zl7y8kk6/U1hfaJc582TPrvNR0V9VGEYq0VZHguUm7tm/4b8feJvB92tzofiHVNJnXpJZ3ckZ/Q19Q/Br/AIKPeNPCNxb2XjiBPF2k5CtdIqxXsY9cjCyfiAfevj+iuXEYHD4qPLVgn+f3m9HFVqDvTlY+3v20v2o7nxE3gbWfhh461Kw0y8spzcxaZeSWzrIHX5ZkUghgD3/Divmf/hpD4r/9FI8U/wDg2n/+Krzmis8LgKGGpKkop26tK5dbF1K1R1L2v5no3/DSHxX/AOikeKf/AAbT/wDxVfeX/BN/x/4m8feEPGc/ibxBqXiCe3v4Uhk1K6edo1MZJClicDNfmPX6M/8ABLL/AJEjx3/2Ebf/ANFGvJzyjShgZOMUnddPM78rqTliopyvv18j7iooor8xPuAooooAKKKKACiiigAooooAKKKKACmySLDG0jnCqCxPsKdXHfGPVn0P4TeNNRjBL2mi3k6gHBysDnr+FXCPPJRXUmUuWLk+h+N/xy+Ik/xW+LXifxPNK0qXl44t8nhYFO2ID0G0D8Sa4WgcCiv2+nBU4KEdlofmM5OcnJ7sKKKCMqR61oQfaP7OH/BPUfFDwRpvizxhr11pFjqUYntNP01E84wn7sju4IXI5ACngjntXoXjD/glvoU1i7eFfGWo2t4q5SPV4o5o3PoWjCFR74P0r3L9kP42eHPil8I/D1hp99AuuaTYRWl/phYLLE0ahdwXqUOMhhxzjrXu1flmKzXMKeJlebjZ7W0/I+5oYDCVKMWo3utz8Nvit8I/E/wX8VS6B4p082d2o3xSqd0NxHnAeNu4/Ud642v2L/a8+Bdr8bfhDqdvFbq3iDS42vdLmC/OJFGWjz1w4BBHrg9q/JP/AIV/4p6Hw1rAPcGwl4/8dr7bK8zjjqPNUspLR/5nzWOwTwtS0dYvYwK6H4d/8lC8K/8AYWtP/RyU3/hX/ij/AKFrWP8AwAl/+Jre8AeBfE0Pj7wzI/h3VkRNVtWZmsZQABMhJJ28CvUqVKfJL3lt3RwwhLmWh+31FHWivxI/TT8Pfjp/yWjx1/2Gbr/0Ya4av1b8Uf8ABO/4YeLvEmqa5fXviNbzUbmS6mWG+jVA7kk7QYjgZPrWX/w7N+Ev/P8AeJ//AAPi/wDjNfpVHiDBQpxi73SXTy9T4uplOJlNyVt+5+XFFfqP/wAOzfhL/wA/3if/AMD4v/jNH/Ds34S/8/3if/wPi/8AjNa/6xYH+993/BM/7HxXl95+XFFfqP8A8OzfhL/z/eJ//A+L/wCM0f8ADs34S/8AP94n/wDA+L/4zR/rFgf733f8EP7HxXl95+XFFfqP/wAOzfhL/wA/3if/AMD4v/jNH/Ds34S/8/3if/wPi/8AjNH+sWB/vfd/wQ/sfFeX3n5cUV+o/wDw7O+Ev/P94n/8D4v/AIzXwl+1N8K9H+DHxq1nwpoMl1LplpFbvG17IJJcvCrtlgoB5J7V24PNsNjqjpUr3tfVHLiMBWwsOepax5LRRRXtHnH0L+wOf+MofC//AFyuv/RLV+u561+RH7A6k/tQ+F/+uV1/6Jav13PWvzTiT/e4/wCFfqfa5N/u79f8j5M/4KXf8m923/YZt/5PX5bV+53xL+Ffhj4v+H00TxZpg1XS1mW4EBmki+dc4OUZT3PevkL9sb9lX4X/AAt+BOreIfDHhddM1eC4t0juRe3EuAzgMNryFentXXkmaUcPTjhZJ8zl5W1t5nNmeBqVZuumrJfkfndRS0lffnyYUUUUAFdR8M/iJq3wp8daR4q0WUx3+nTCQLk7ZU6PG3qrLkH61y9LUyjGpFwmrplRk4tSW6P3P+F3xJ0j4teBdI8U6LLvstQhEnl5y0T9Hjb/AGlbI/CuZ/ai/wCTefiB/wBgif8AlXwR+wD+0V/wrHxyfBmtXOzw14glCwvI2Ftbs8K3sr8KfcKfWv008UeGdN8ZeH9Q0PWLb7Zpd/C1vc2+9l8xD1GVII+oNfkuNwjy3GKL+G6a9L/mffYausbh21vaz9T8GF6Civ1G+OX7Gvwg8JfBrxrrWj+D1s9U07SLm6tbgX103lyJGWU4aUg8juMV+XNfpOAzClmEZTpJq3c+MxWEnhJKM3uFFFe6fsY/Dfw78Vvjpp/h/wAU6eNU0iSzuZXtjK8WWVMqdyMDwfeuyvWjh6Uqstoq5z0qbqzVNbsm/YZ/5Og8Hf70/wD6KavrX/gpp8RpfD/wz0TwnaymOTXrsy3IVsEwQ4OD7Fyv/fNe2eCf2S/hV8N/E1n4h8OeFV07WLMsYLkXtzJsyCD8ryFTwe4r4z/4KiXksnxW8I2zNmGHSHZF9C0p3H/x0V8RTxNHNM1pVIJ2iuvdXZ9POhUwOBnCT1b/ADsfGFFFFffHyYV6N8A/gnqnx8+I1n4W024WyVo2uLq9kQutvCuNzYHU5IAHckV5zX0L+w38YtD+DPxq+3+I5vsmk6nYSabJeEErbszxurtj+HMeCe2c1xY2dWnhqk6KvJLQ6cNGE60Y1PhvqfWFp/wTE+G8disdx4h8ST3WBunSaBBnvhfKOB9SfrXg/wAfP+CePiL4a6Tc694P1CTxZpNupkntHiCXkKAZLADiQDvjB9q/TTTdStNYsYL2wuYb2znUPFcW7h43U9CrDgirLKGUjAP1r80o51jqNTmlPm7p/wBaH2lTLMNUjZRt5o/AWivrH9sz9lfXfDPxhub/AME+FtT1XQtaj+2+XpNjJOlrMWxJGdinaCfmA9G9q8I/4UP8Sv8Aon3in/wTXH/xFfpOHxtDEUo1VJa+Z8ZVw1WlNwcW7HC1+jP/AASy/wCRI8d/9hG3/wDRRr4g/wCFD/Er/on3in/wTXH/AMRX3x/wTY8F+IfBfhDxnB4h0LUtCmnv4Xij1K0kt2kURkEqHAyM+leRntanLAyUZJu66+Z6OV05xxUW0+v5H2TRRRX5gfcBRRRQAUUUUAFFFFABRRRQAUUUUAFc78RNA/4SrwD4k0XbvOoabc2oXOM74mXGfxroqKqLcWmugpLmTTPwHkieGR45FKSIxVlYYIIOCPzple+/tq/Bmf4R/GzVZYYCmha87alYSKPlyxzLH9Vcnj0IrwKv2vD1o4ijGtDZo/M61KVGo6ct0FFFFdBiX9D13UvDOq2+p6Rf3OmajbtuiurSUxyIfYivsr4I/wDBSjXvD/kab8RdPPiCyGF/taxCpdoPV04WT8Npr4morhxWBw+Mjy1o38+v3nVQxVbDu9N2/I/cb4Y/GTwd8YNJGoeFNdtdVjxmSFW2zwn0eM4ZT9RXa1+C3h7xJqvhHVoNU0TUbrSdRhOY7qzlMbr+I7e1faXwL/4KT6ppBttK+Jdl/atoMINbsEC3CD1kjHD/AFXB9jXw2N4erUbzwz5l26/8H+tD6jDZvTqe7WVn36H6L0VzngT4h+HPiZoMOs+GdXttY0+Qf623fJU/3WXqp9jXR18nKLi+WSsz34tSV1qgoooqSgopG6Gvk34mftma14D8fa74fg8O2N1Dp9yYEmkmcM4AHJA7813YPA18dN08OrtK+9jzMfmWGyyCqYmVk3ba59Z5ozXxN/w3zr//AEKum/8AgRJR/wAN86//ANCrpv8A4ESV63+ruZf8+196/wAzwv8AWzKf+fj/APAX/kfbOaM18Tf8N86//wBCrpv/AIESUf8ADfOv/wDQq6b/AOBElH+ruZf8+196/wAw/wBbMp/5+P8A8Bf+R9s5ozXxN/w3zr//AEKum/8AgRJR/wAN86//ANCrpv8A4ESUf6u5l/z7X3r/ADD/AFsyn/n4/wDwF/5H2xXzF8bP2D/Dfxv+IuoeL9R8T6vpt3eJEjW9pHEY12IEBBZSeQtc54N/bc1zxR4u0bR5PDWnwR313HbtIk7kqGYDIB719gCuOpRxuTVU5e5Jryeh6uFx2CzqnJ0vejF63TWp8T/8OtfBv/Q7eIP+/UH/AMTR/wAOtfBv/Q7eIP8Av1B/8TX2zRT/ALZx/wDz9f4f5HV/Z+F/kR8w/BP9g3w18EfiJp/i/T/E+r6ld2aSItvdxxCNt6lSSVUHjNfT1FFefiMTWxU+etK7OulRp0I8tNWQV83/APBQb/k2LXv+vq1/9GivpCvm/wD4KDf8mxa9/wBfVr/6NFb5f/vdL/EvzMsX/u9T0Z+SlFFFfsp+bhRXX+C/hjrHj7w74s1TSI/tB8N2kd9dW6gl2gZyrOv+71I9MntXIVEZxk2k9VuU4uKTa3CiiirJFVirBlJVlOQVOCK/Wf8AYg/aIX40/DddL1W4D+K9BRbe73H5riHpHOPXI4b3HuK/Jeu++B3xd1P4IfEnSvFWmlnW3fZd2obAubdvvxn8OR6EA142bYBY/DuK+Jar+vM9LAYt4Wqm/he5+uv7Sn/JvnxH/wCxfvf/AES1fibX7MfGHxdpnjz9lPxp4h0a5W70zUfDF3cQSr3UwNwfQg5BHYg1+M9ePw0nGlUT3v8AoejnTTnTa7CV9M/8E7v+TmtJ/wCwfef+i6+Zq+mf+Cd3/JzWk/8AYPvP/RdfQZl/uVb/AAs8nBf7zT9UfrFX5yf8FSPD00PjTwTroDG3uLGa0Ldg6OGA/EMfyr9G68E/bT+Cs/xo+Cl/badD52u6Q39pWKL96RkB3xj3ZM49wK/MspxEcNjITlts/nofbY+k62HlGO+/3H4/0UrKVYqwKsDggjBB9KSv14/PAooooA9O+Dv7R/jz4G3gbwzrMg09m3S6Vd5ltZPX5D90+64NffnwS/4KHeB/iEYNO8WL/wAIXrT4UPO++ylb/Zl/g+j8e5r8taK8bGZThsbrONpd1v8A8E9HDY+vhtIu67M/fa1vIL63juLaeO4gkXcksThlYeoI4IqXNfi18G/2m/H/AMDrqP8A4R/WXl0sNl9Ivsy2rj2UnK/VSK/Qv4B/t4eBvi40Gl6y6+EPEkmFFreyA287f9MpTgf8BbB+tfB47JMTg7yiuaPdfqj6vC5nRxFoy92X9dT6azRSBg3Tmlr589cKKKKACiiigAooooAKKKKACiiigAooooAKKKKAPLf2ivgPpX7QHw8udAvyttfxHz9Ov9uWtpwOD7qejDuPcCvx9+I3w38QfCjxZeeHfEthJYalbnow+SVe0iN0ZT2Ir91K4H4v/A7wh8cNA/svxVpi3WzJt7yP5Li2Y943HI+nQ+lfRZVm0svfs56wf4eh42Py9Yr34aS/M/EKivqT47fsB+OPhe1xqXhpJPGXh1ctutY/9MgX/biH3sf3kz7gV8vSRPDI8ciNHIh2sjghlPoQehr9Jw+Ko4uPPRldf1ufF1qFShLlqKwyiiiuowClpKKAOw+F/wAWvFHwd8Sw634V1SXT7pCPMizmG4X+5InRlP5jtzX60fszftIaP+0R4K/tC3VbHXrPbHqWmF8mFyOHXuY25wfqDyK/GevQvgP8YtT+BvxK0vxPp7s0ET+VfWqni4tmI3oR645HuBXgZrlcMdTcoK1RbPv5M9fL8dLCzUX8LP25orP8P63Z+JNDsNW0+ZbixvoEuYJVPDI4DKfyNaFflTTTsz7zfVCN901+Yv7RP/JbvGX/AGEH/kK/Tpuhr8w/2ipFHxw8ZAsB/wATBu/sK+14T/3up/h/VH53xv8A7nS/xfozzyim+Yn94fnR5if3h+dfqR+MjqKb5if3h+dHmJ/eH50AOopvmJ/eH50eYn94fnQB1/wj/wCSpeEv+wnB/wChiv1T7mvyq+Eci/8AC0vCWGH/ACE4O/8Ativ1V55+tfmXFn8el6fqfsHA/wDu9b/EvyCiiivhD9LCiiigAr5v/wCCg3/JsWvf9fVr/wCjRX0hXzf/AMFBv+TYte/6+rX/ANGivQy//e6X+JfmcmM/3ep6M/JSiiiv2U/Nj7Y/4Jd28d1488exSossUmkwo6OMhlMpBBHoRXkH7Yv7PsnwH+KEy2MLDwtrBe60yTHyx8/PBn1Qnj/ZK17J/wAEs/8AkoPjn/sFwf8Ao019nftGfBOw+PHwv1Hw5cqkd+P9I066YcwXCg7Tn0P3T7E18JiMe8Dm0pS+BpJ/dv8AI+ro4RYrAJL4lex+KlFaHiDQb/wvrl/pGqWz2mo2M729xA45R1OCKz6+6i1JXR8q1Z2YUUUUxH0n+z7+0UPDPwb+JPwz12626bqmh30mkSSNxFcmFsw/R+3+1x3r5tpKK5qeHhRnOcPtO79TedaVSMYy+yFfTP8AwTt/5Oa0n/sH3n/ouvmavpn/AIJ2/wDJzWk/9g+8/wDRdc+Zf7lW/wALN8D/ALzT9UfrFRRRX42fox+cn7cn7Hd3oeqaj8RfBVk1xpNwxn1bTbdMtbSHlpkUdUJ5YDocnp0+H6/fplDKVIyD1HrXyX+0N/wT88LfEyS51rwfJH4T8RSEu8Kp/oVw3X5kH3CfVfyNfb5XnqpxVDFbLZ/5/wCZ8xjsqc5OrQ+7/I/Lmiu8+KnwP8a/BfU2s/FmhXGnpuxFeKPMtph6pKPlP04PqBXB193TqQqxU4O6fY+VlGUHyyVmFFFFWQFFFFMD6+/ZD/bc1T4c6nY+E/HF9NqXhKZlht76di82nE8DLHlovUH7vbjiv05t7iO7gjnhdZYZFDpIhyrKRkEHuCK/Aiv0p/4JyfHyfxh4Wu/h7rVz5uo6HGJtOkkOWktCcFM9yjEfgw9K+Dz7K4xj9boq38y/X/M+qyrHNy9hUfp/kfaVFFFfCn1QUUUUAFFFFABRRRQAUUUUAFFFFABRRUF85js7hlOGWNiCPXFMCeivxjP7XXxjyf8Ai4Wsdf8Anov/AMTR/wANdfGT/ooWsf8Afxf/AImvrVw1iX9uP4/5Hz39tUf5X+B+zleQfGL9lX4dfGqOSTW9DjttWYfLq2nYguQfUsBh/owNfmGv7XnxkRlb/hYOrttIO1pFwfY/LX6xfBH4mWfxg+F3h/xVZurG+t1+0Ip/1c6jEiH0wwP6VwYvL8VlPLVUt+qudeHxdDML03H5M/O740f8E7vHXgBZ9Q8Jyr4z0dMt5cK+Xexr7x5w/wDwE/gK+VLuzn0+6ltbqCW1uYWKSQzIUdGHUMp5B+tfvrXgv7T37K/hn46eGL66Wyh0/wAX28DvZarCgRmYDIjlx99D055GcivXwHEU1JU8Wrrut/medisnjZzw7t5H4/UU+aGS3mkhlUpLGxR1PUMDgj86ZX358mFFFFAH6sf8E6fHk3iz9n6LS7mRpJ/D97JYqWOT5JxJGPw3Mo9lFfUdfCn/AAStZv8AhF/iGP4Re2mOf+mclfddfkGbU1Sx1WK73++zP0PL5ueFg32Csu48K6LdzvNPo9hPM5y8klqjMx9SSOa1KK8tScdmd0oxl8SuY/8Awhvh/wD6AWm/+Acf/wATR/whvh//AKAWm/8AgHH/APE1sUVXtJ/zMj2VP+VfcY//AAhvh/8A6AWm/wDgHH/8TR/whvh//oBab/4Bx/8AxNbFFHtJ/wAzD2VP+VfcY/8Awhvh/wD6AWm/+Acf/wATR/whvh//AKAWm/8AgHH/APE1sUUe0n/Mw9lT/lX3GTF4S0O3lSWLRdPjkQ7ldLWMFT6g44Na1Ffnp+3x8ePiD8NPjZZaT4X8V6homnPo0Fw1vasAhkaWYFuR1IUflXZg8LUzCt7KMtfM58RWp4On7Tl08j9C6K/GP/hrr4yf9FC1j/v4v/xNH/DXXxk/6KFrH/fxf/ia9/8A1axP88fx/wAjy/7ao/yv8D9nKK/NP9i/9oj4k+P/ANoLQ9F8ReMNS1bSpoLhpLS4dSjFYyVJwOxr9LK8DHYKeBqqlUabtfQ9XC4mOKhzxVtbBXzf/wAFBv8Ak2LXv+vq1/8ARor6Qr5v/wCCg3/JsWvf9fVr/wCjRRl/+90v8S/MeL/3ep6M/JSiiiv2VH5ufbf/AASzP/FxfHA/6hUH/o01+kFfm1/wS3b/AIub40HrpMX/AKNr9Ja/K8+/36XovyPvMq/3WPzPgr/go5+zp9pt0+KWg2376ILBrcUa/eTpHcfUcK3tt9K/Pqv3u1fSbPXdLu9O1C3ju7G7iaCeCUZWRGGGU+xBr8av2nPgXd/AL4oXuhsJJNGuc3Wl3TD/AFkBPCk/3kPyn6A96+i4fzD2sPqlR6x29O3yPGzfCezl7eC0e/qeS0UUV9kfOBRRRQAV9M/8E7v+TmtJ/wCwfef+i6+Zq+mf+Cd3/JzWk/8AYPvP/RdedmX+5Vv8LO3Bf7zT9UfrFRRXxT/wUf8AiZ4s+HcfggeGPEepaB9qa58/+z7lofM2hMbtp5xk/nX5Pg8NLGV40IuzZ97iK6w9J1Wr2PtaivxM/wCGkvisTk/EbxP/AODWb/4qj/hpL4rf9FG8T/8Ag1m/+Kr6f/Vmv/z8X4ni/wBtUv5GftLrOhaf4g02bT9UsbfUbGYbZLe6jEiMPcHivkn4yf8ABN7wd4uNxf8Agi7bwhqTZYWjAy2Lt6bfvR/8BJA/u15d+wT+074h1X4oXfhLxr4m1DWYtZh/4l0up3TSmO4TJ2KWJxvXP4r71+itePWji8mxHs4Tt102fyO+n9XzKlzSj/mj8T/i/wDs6+PPgfdlPE+iSRWJbbHqlr+9tZPTDj7p9mwa80r98dU0qy1rT57HULSC+sp1KS29xGHjkU9Qyngivyr/AG6f2c9K+BvjbTNR8NxtbeHddSRo7MkkW0yEb0Un+EhgQO3NfX5Xnf1yaoVlaXRrZ/5Hz+Oyz6vH2tN3j+R8xUUUV9WeAFerfss+Opfh58fvBmqpIUhkvks7jn70U37th/48K8prU8LSSQ+KNFkiJEqX1uyFeoYSKRj8awr01VpThLZpmtKThUjJdGj95+nFFRWrM1rCW5YopOfXFS1+In6cFFFFABRRRQAUUUUAFFFFABRRRQAVX1H/AJB91/1yf+RqxVfUf+Qfdf8AXJ/5GnHdCex+Bp+8frSUp+8frSV+6LY/L5BXv37Kf7V2qfs665La3UMmq+EL+QPeaejAPE/Tzos8bsAAg8ED8a8BorCvQp4mm6VVXTNKVWdGSnB2aP2h8E/tWfCnx7YxT6f410uCV1ybXUJhbTp6go+Dx6jIrnfjT+2P8Ofhn4X1GS18RWOv675Lpa6ZpswmdpCp27yuQi5xkk/TNfkAVDdRmjAHQYr5ePDWHjUUnN27afme286rONuVX7kt1cyXl1NcSkNLM7SOQMAsxJP6moqKK+vtbY+eCiiuv+FHwx1j4wePNK8LaJCz3V7IBJLtysEQ+/K3oFH64HeonONOLnN2SKjFzkox3Z+iP/BNHwZJoPwT1LXJojG2uam7xkj78USiNT/315g/CvrusLwL4O0/4f8Ag7RvDelR+Xp+l2qWsI7kKMbj7k5J9zW7X4xjK/1rETrd2fpGHpewpRp9kfl/8cP20/i34P8AjF4y0PSfEMVtpmn6pNbW0Js42KRq2AMkZNcR/wAN7fGz/oaYf/AGL/CuE/aU/wCTgPiF/wBhq5/9Drzav1LD4DCSowbpRvZdPJHw1bFV1UklN7vqfQn/AA3t8bP+hph/8AYv8KP+G9vjZ/0NMP8A4Axf4V890V0f2fg/+fMfuMfreI/nf3n0J/w3t8bP+hph/wDAGL/Cj/hvb42f9DTD/wCAMX+FfPdFH9n4P/nzH7g+t4j+d/efQn/De3xs/wChph/8AYv8KP8Ahvb42f8AQ0w/+AMX+FfPdFH9n4P/AJ8x+4PreI/nf3n0J/w3t8a/+hph/wDAGL/CvJ/iZ8UvEvxe8Sf294qv/wC0dT8lbcSiMIBGpJVQBx1JP41ydFa0sJh6MuanTSfkjOeIq1Fyzk2vUKKKK7DA+i/+Cf8A/wAnQeHf+va6/wDRRr9cK/I//gn/AP8AJ0Hh3/r2uv8A0Ua/XCvzPiP/AHxf4V+p9rk3+7v1Z8xf8FCfFmteDfgZb3+g6teaNenVoIzcWMzROVIbK5HOOK/M3xB8WPGvizTH07WvFms6rYOQzW15eySRsQcglSccV+j3/BS3/k3u2/7DNv8Ayevy1r6Hh6nCWD5nFN3f6HkZvOSxHKnpZBRRRX1R4JreHfFuueEbmW40LWb/AEaeVdkkun3LwM65zglSMivrX/gn38SfFvir4/fYda8T6xq9l/ZVy/2e+vpZo9wKYO1mIyPWvjSvqj/gm7/ycb/3B7n+aV4+a04PB1ZW1sejgJSWIpq+lz9U68S/a0+AFv8AHz4X3VjAiJ4j00Nd6VO3H7wDmIn+6449jg9q9to61+UUa06FSNWm7NH31SnGrBwnsz8Cryzn0+8ntLqF7e5gkaKWGQYZGU4KkeoINQ19vf8ABRT9nM+HtbHxN0G1xpuoSLDq8Ua8Q3B4Wbjs/Q/7QHrXxDX7DgsXDG0I1odd/Jn51icPLDVXTkFFFFdxyhX0z/wTu/5Oa0n/ALB95/6Lr5mr6Z/4J3f8nNaT/wBg+8/9F152Zf7lW/ws7cF/vNP1R+sVfAf/AAVS/wBX8Pf9+6/klfflfAf/AAVS/wBX8Pf9+6/klfm+S/7/AE/n+TPssz/3Sf8AXU+AKKKK/WT4AsafqFzpN9b3tnO9rd28izQzRNtaN1OVYHsQRmv0d/Z7/wCCinhvWtDtNJ+JMjaHrsKhDqyxFrW6x/EwUExse/G3vkdK/NqivMx2X0MfFRqrVbNbnbhcXVwkr0+vQ/amT9qT4RxWpnb4jeHCqruIW/Qt07KDkn2xmvz0/bm/aT0b48eKtGsPDDSz+H9EWTbdyIU+0TPgMyqeQoCgAnGea+YaK4MFkdDB1VWUm2trnZiszq4mn7NpJMKKKK+iPGCvSP2cfBs3j746eCtGiRmD6lFPKV/hjiPmMx9sLXm9foz/AME4/wBnu48OaVc/EvXLVobzUoTbaTFKuGS3Jy82O28gAf7IP96vKzTFRweFnNvVqy9Wd+Bw7xFeMbaLV+h9xUUUV+Pn6IFFFFABRRRQAUUUUAFFFFABRRRQAVX1H/kH3X/XJ/5GrFMnhFxDJGTgOpUke4xTW4nsfgQfvH60lfpP/wAOtfA+Sf8AhMvEX/fNv/8AEUn/AA618D/9Dl4i/wC+bf8A+Ir9S/t/AfzP7mfD/wBk4r+Vfefm9awG6uoYVIUyOqAnoMnFd/8AGL4B+NPgbrLWPijSZIbdmIt9ShBe1uB6q/QH/ZOCPSvue1/4Je+CbW6hmXxj4iZonVwCtvgkHP8Acr7C1nQtO8RabPp+qWNvqNhONsttdRLJG491IxXnYniKnCcHh1zR1v09LHVRyecoyVXR9Op+CVFfql8RP+Cc/wAL/GEktzo32/wjduScafIHgz/1zfOB9CK8U1j/AIJZ65HMf7J8eWFxEWOFvLB42UduVYgn8BXo0c+wNRe9Llfmv8rnHUynEwekb+h8MUV9u2f/AAS18VSXCrd+ONJgh7vDZyyMPwJX+deqeAv+CZPgXQ545/E+uan4lkXBNugFrAT9Fy2PbdV1M+wFNXU+Z+SZMMrxU9HG3qfn/wDC/wCEvin4x+JItF8K6VNqFySPNmxiG3U/xyP0UfqewNfq5+zF+y/on7O3hdo42TUvE16o/tHVduC3fyox/DGD+Z5PbHqHg3wJ4f8Ah5osek+GtHtNF06PpBaRBAT6serH3JJrer4rMs4q45eziuWHbq/U+lwWWwwvvy1l+QUUUV88ewfif+0wNv7QnxDHT/id3P8A6FXmlfqR8Q/+CdPhD4ieOtd8UXfinXLS61e7e8kgt1h8uNmOSFymcfWue/4dbeB/+hx8Rf8AfNv/APEV+mUM8wNOlCEpO6S6PsfFVMrxMpyklu+5+bFFfpP/AMOtvA//AEOPiL/vm3/+Io/4dbeB/wDocfEX/fNv/wDEVv8A2/gP5n9zM/7JxP8AKvvPzYor9J/+HW3gf/ocfEX/AHzb/wDxFH/DrbwP/wBDj4i/75t//iKP7fwH8z+5h/ZOJ/lX3n5sUV+k/wDw628D/wDQ4+Iv++bf/wCIo/4dbeB/+hx8Rf8AfNv/APEUf2/gP5n9zD+ycT/KvvPzYor9J/8Ah1t4H/6HHxF/3zb/APxFH/DrbwP/ANDj4i/75t//AIij+38B/M/uYf2Tif5V95+bFFfpP/w628D/APQ4+Iv++bf/AOIo/wCHW3gf/ocvEX/fNv8A/EUf2/gP5n9zF/ZOJ/lX3nzH/wAE/wD/AJOg8O/9e11/6KNfrhXzL8FP2D/C/wAEPiHYeLtM8S6zqN5aRyRrb3iw+WwddpztUH9a+mq+JzjF0sZiFUou6skfS5bh6mGouFRa3Pk7/gpZ/wAm923/AGGbf+T1+WtfuN8Wvg/4b+NnhdNA8U281zpqzrchLeYxNvXODkfU147/AMO7vgv/ANAjUv8AwZSV6uU5xh8Dh/ZVU73b0Xp5nBmGXVsVW9pC1rH5N0V+sn/Du74L/wDQI1L/AMGUlH/Du74L/wDQI1L/AMGUle1/rHg+0vuX+Z5v9jYnuj8m6+qP+Cbv/Jxv/cHuv5pX15/w7u+C/wD0CNS/8GUldl8Kf2Sfh18F/FX/AAkPhewvLbU/Ie23z3jyrsbGRg/QVxY3PcLiMNOlBO7Vtl/mdWGyuvRrRnJqyZ7LRRRXwB9YY/jDwnpvjrwzqegaxbrdaZqMDW88TDqrDGfqOoPqK/Fz46fCDU/gf8StU8K6iGeOBvMs7ojAubdidkg/Dg+hBFft3XiX7TH7Luh/tIaVpcV7eyaPqunSloNSgiDv5bD5oyD1BOD7EV9Bk+ZLAVWqnwS38vM8jMcG8VTvD4l/Vj8caK/Qz/h1fpX/AEUC+/8AABP/AIqj/h1fpX/RQL7/AMAE/wDiq+1/t7Afz/gz5n+ysX/L+KPzzr6Z/wCCdv8Ayc1pP/YPvP8A0XXuf/Dq/Sv+igX3/gAn/wAVXpH7P37Ctj8BviVa+LYPFl1q8kFvNALaW1WNT5i4zkHtXFjc6wVbDVKcJatNLRnThctxNOtCco6Jn1PXwH/wVS/1fw9/3rr+SV9+V5B8fv2Y/DX7Ra6OPEN7qFoNLMhh+wyKm7fjO7IPpXxWW4iGFxUK1TZX/I+mxtGdehKnDdn4x0V+nn/DsX4Z/wDQa8Qf+BEf/wARR/w7F+Gf/Qa8Qf8AgRH/APEV97/rDge7+4+V/sjE9l958KfDH9nPxf8AGHwT4g8Q+FII9TfRJ44Z9NU4uJFZC26PPDYx93qe1ebahp91pN9NZ31tNZ3cLFJLe4jKSIw6gqeQa/Zz4A/s3+Hf2ddN1iy8PXl/eRapMk8xvpFYqyKVGMAcYNavxQ+AHgH4xQlfFXhy0v7nG1b5V8u5T6SLhvwORXmriSMa8k43p9Hszs/sVypJp2l17H4jUV+j3i7/AIJd+Fr6WSTw34u1PSM52Q3sKXKL6cjax/E1xE3/AASx1xZgIviBp7xd2fTXU/l5h/nXswz3ATV+e3qmedLK8VH7Nz4Yp0aNJIqIrO7HCqoySfQCv0H8N/8ABLPT4rgNr3j26uos8x6dYrCSPTLs/wDKvpD4T/sl/DP4Oyx3WieH47nVU6alqTfaJwfVS3C/8BArmr8Q4Smv3d5P7vzNqWT4ib9/3T49/ZO/YL1LxVe2Xiz4kWUmnaFGwmttDnBWe8PUGUdUj/2TyfYV+j9raxWdvHBBGkMMahEjjUKqqOAAB0AFSYpa+CxuOrY6pz1X6Loj6vDYWnhYcsPvCiiivOOwKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKK86+O/x88H/s5+A7nxX4y1D7JZIfLt7eIbp7uUjIiiTux/IDkkUAei0V+K/wAbP+CuHxZ8dahcQeBktfAGibiImjiS5vWXPBaRwVU47KvHrXzjqv7XHxt1q4kmu/ix4wdpOWWPWJ4k/BEYKPwFArn9G1Ffzm6T+198cNFuEmtfiz4w3IMKs2sTTJ/3w7Ff0r9Cf+CY/wC2h8U/jz8U9Y8F+PNat9e0+z0STUILp7NIroSJNCgBaMKrLtkbqucgc0AfpTRRRQMKKKKACiiigBGYRqWY4VRkmvC2/bo+AMbMrfFbw6GU4I+0H/Cvbr7/AI8rj/rm38jX8u0wHnScfxH+dAj+k/4Y/tAfDr4z3V9beB/F+m+Jp7FFkuY7CQuYlYkKW47kGvQa/Jf/AIImj/iu/ifx/wAw20/9GvX60UDCiiigAooooAKKKKACiq2panZ6PZyXV/dQWVrGCzzXEixooHUliQAK8r0P9rT4S+KviRYeA9B8babr/ie88wx2ulMblAEUsxaVAYxgDpuzQB67TZJUhQvIwRFGSzHAAHUk06vif/grb478ReC/2YLe30G5uLODWtZh07Up7clWFsY5XKFh0DMiKfUHHegR9HR/tLfCebXP7GT4jeGW1PzPKFuNUhyX/u53Yz+NekJIsihlO5TyCOhr+XMKoIO0flX7jf8ABKfx54i8cfsrWg8QXM98ulalcadY3VwSzNboFKpuPUISVHoAB2oA+yKKKKBhRRRQAUUUUAFGKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvw2/wCCqHxm1D4kftQat4bNw/8AYXhBE061tskJ5zIrzyY/vFmC59EHrX7kmv5/f+CiHhm+8L/tj/EiO+iMf269TULdsHEkMsSMrD15yv1U0AeE+DfCOqePvFuj+GtEtvter6tdR2VpBnG+V2CqM9hk1+q3wz/4IweD7PR4JPHvjLVtV1d0zLBo4S3tomOOFLBnbHIycZ9BX5bfDPx5qHwt+IfhvxhpSxyajod/DqEEcwyjPGwYK3scY/Gv3k/Zp/bm+GX7SulWqaZrEOjeKXUef4d1KRY7hH7iMnAlXPQrz6gUCR86eMf+CL3w71C1b/hGfG3iDRLvbhPtiRXcW71YYVvyYU79hD9hn4gfso/tNa7qHiBrLWPDN14duLa01vT3+R5Tc27CN42+aNtqse44OGNfogDmigYUUV8d/tnf8FGPDH7MdzL4Y0O0j8V+PigZ7HzNttYAjKmdhzu7+WvJHUrQB9iUV/Px8Sv+Cgfx5+J15PJeePr/AEa0kJxYaFiyhVT/AA/J8zAerEn3rz+P9pX4tQyK6fErxSrqcg/2rLwR/wACoFc/pHor8Mvgn/wVL+NPwt1GBPEGqL8QdD3DzrTWsfaNvcpcKNwb/e3D2r9d/wBnH9pTwd+074Bj8TeE7psowivtNuMC4sZsZ2SKP0YcEdO9Az1C+/48rj/rm38jX8us3+uk/wB4/wA6/qKvv+PK4/65t/I1/LrN/rpP94/zoEz9KP8Agib/AMj38T/+wbaf+jXr9aK/Jf8A4Im/8j38T/8AsG2n/o16+6/27viF4h+Ff7LHjbxR4V1KTSNesUtjb3kSqWj3XMSNgEEcqxH40Aj32iv5/v8Ah4h+0P8A9FM1H/vzD/8AEV+t3/BPL4neJvjB+y7oHibxfqsmta5cXl7FLeTKqs6pO6qCFAHAAFAz6ToqO5YrbSsOoQkflX4J+JP+Cg37QVn4j1a3h+JOoRww3k0aKIYflUSMAPuegoA/fCjIzivzg/4JX/tMfEv48eOvHNh478VXPiG1sNNhnto54418tzLgkbVHauf/AOCoH7VHxU+B3xu0DRvA/i+60DTLjRVuZbeCONlaTzXG75lPYCgD5A/4KB+NvEOu/tWfEvSdR13Ur7SrDV2itLC4uneC3QImAkZO1fwFbf8AwS7/AOT0PBuP+fe8/wDRDV82eM/GWs/ELxVqniXxDfPqWt6nMZ7u7kADSyEAbiAAOgHSrfw5+JHiT4S+LbTxP4S1STRtdtVdYbyFVLIGXawwwI5BxQB/TXXLfE34aeG/jB4J1Pwn4s02PVdC1GPy5reTgg9VdW6qynBDDkEV+OH7M37dXx08aftEfDbw/rfxAvtQ0fVPEFlZXlrJFEFlikmVXU4TPIJr9I/+CiPxO8T/AAf/AGWtf8T+D9Wl0TXba9sY4ryFVZlV7hFcYYEcqSKAPDIf+CMPwxTxD9rfxl4ofSA+4admAHGc7TLszjGBnGfevuP4c/Dvw98J/Bel+FfCumxaVoemxeVBbxfmWY9WYnJJPJJr8I/+HiH7Q/8A0UzUf+/MP/xFfr1+wJ8SPEnxZ/Zd8K+JvFmqSazrl09ws15Kqqz7ZmVc7QBwABQB9D0Vl+KPE+leC/D2oa7rl/DpekafC1xdXlw22OKNRkkmvyl/aU/4K++JNZ1O80f4O2cOiaNGTGviDUYBLd3HbdHE3yxqe24M3+7QB+t3XpRX84+vftZfGfxNfG81H4n+J5pjnG3UXjVcnOAqkAD2FTeGf2vfjV4QvxeaZ8TvEkcuQSs180yPjoGR8gj2IoFc/oyor8u/2U/+CuVxqWsWPhr4029tBHcMsUXirT4vLVWPA+0xDgAn+NMAd171+n9rdQ3tvFcW8qTwTIJI5Y2DK6kZDAjqCOc0DJaK+Lf+CpXx08bfAj4ReE9T8Da9N4f1G+1v7LNcQIrM8Yhkbb8wPdR+VfmY/wDwUR/aICMf+Fmaj0/54w//ABFAj+gXI69qOvSvy6+OX/BUbVfh78IfBXhnwbdW+tfEW80O1udb1+6RZYrKV4wSqoPleY5yc/KvoT0+C9e/aw+M3ibUpL7UPid4mluJDyY9QeNQM5wFUgAc9AKAuf0c0V+En7PH/BSr4t/BnxBZrr2u3XjrwrvVbrTNYk82VY88mGY/MjAcgElT3Fft74D8baT8SPBmjeKNBuheaPq1ql3azDujDIB9COhHqDQM3qKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvjX/gob+w2f2oPDlr4k8LtDbfEDRYWjt0lISPUYM7vIduzA5KseOSDwc19lUUAfzEeMPBuufD/wARXmheJNJu9E1i0cxz2V9EY5EI9j1HoRweorJhme3mSWJ2ilQ5WRCQyn1BHSv6SPjB+z18PPjzpJsPHPhex1xVUrFcyR7biH/clXDL9M49q/OL9o//AII96joNje658IdZm1qKINJ/wjmrFRc7RzthmGA59FYAn1J4oFY8N/Z0/wCCm3xY+B8tpp2t37+PvCsW1GsNYlLXMSDj91cfeGB0Vtw4A4r9gv2d/wBpDwZ+014Fj8S+D71pFQiO90+4wtzZSkZ2SL29mHBHSv5ydR0660fULmxvraWzvbaRoZredCjxupwysDyCCOlfQH7Bfx01H4GftJ+FLyG6eLRdZuo9J1a33YjlhlYKGI6EoxVge2D6mgD9tv2nvjInwD+BPi/xvtWS602zb7HG4yHuXOyIEdxuYE+wNfzo+IPEGo+Ktc1DWdXu5b/VdQne5urqdizyyMcsxJ6kk1+zf/BYTVJrL9lW1tIyBFea/aJL6kKHYfqBX4qUAz7K/YH/AGBG/aq/tDxP4n1C60bwNp04tQbMAXF9PgFkRmBCqoIy2DycDocfeHiL/gkf8B9W0OW00631zRb4riO/h1EysrY6srgqw9Rx9RXoH/BOHRbPRf2MvhuLMowu7SS7mMY/5avM5fPvmvpagD+b79pD4B63+zX8WtX8D65Kl1Ja7ZrW9jXCXVu/McoHbPII7EEV3/7Afx8vfgL+0h4buvtLR6Drk8ekarBk7HilYKjkeqOVYH69ia+iv+C1Vhbw/Fz4d3ibFuZtEmSTA+YhZ/lJ/MivzstbqWxuoLmA7Z4ZFljOM4ZSCD+YFAj+oS9/48rj/rm38jX8u03+uk/3j/Ov6edKme48JWkshzJJYozH3MYJr+Yab/XSf7x/nQNn6Uf8ETf+R7+J/wD2DbT/ANGvX2T/AMFL/wDkyr4i/wDXOz/9K4a+Nv8Agib/AMj38T/+wbaf+jXr7J/4KX/8mVfEX/rnZ/8ApXDQCPwRr90f+CU//JmHhj/r/wBQ/wDSl6/C6v3R/wCCU/8AyZh4Y/6/9Q/9KXoA+t7vi1n/AOubfyr+YzxZ/wAjZrn/AF/3H/o1q/pzvP8Aj0n/AOubfyNfzF+LP+Rq1v8A6/7j/wBGNQDP0L/4Ip/8lM+JP/YIt/8A0dX29+0j+wV8Of2pPGVj4l8X3mu2+oWdmLKNdMu0ij8sMWyQ0bHOSe9fEP8AwRT/AOSmfEn/ALBFv/6Or9bqAR/N3+0x8NtL+D/x+8deC9EkuJdJ0TUmtLZ7tw8pQKpG5gACefQV0n7F/wAFtB/aC/aG8P8AgfxLLeQaPfxXEkr2EgjmykZYYYqQOR6VY/bu/wCTw/i1/wBht/8A0BK7b/gl3/yeh4O/6973/wBENQM/Rz4c/wDBK74PfC/x94e8X6Tf+J5dU0O+i1C1S6v43iMsbBl3ARAkZA4yKsf8FWv+TLfFH/YQ07/0qjr6+r5B/wCCrf8AyZb4o/7CGnf+lUdAmfhhX7wf8Ev/APkzHwX/ANdbv/0e9fg/X7wf8Ev/APkzHwX/ANdbv/0e9AkfL3/BY/8AaCvI7/w/8IdKunhs3gXV9aEbEeaSxEELew2lyPdPSvzEsbG41S+t7O0he4uriRYYYYxlndiAqgdySQK+mP8AgpZq82sftofEBpsZt2tbZMf3Ut4wK5T9hnR7bXf2vPhVaXYRoP7bjn2yDILRq0if+PItAH6F/AH/AIJBeA9L8H2V58UrvUdd8TXUKyT2Nlc/Z7WzYjPlgqNzsvQtnHXjoa479r7/AIJR+F/C/wAOdX8YfCe41C3v9Iga7udCvpvPjuIUXL+U5G5XABbBJzg9OK/UKo7i3iu7eSCdFkhkUo6MMhlIwQfYigZ/Ln1HtX7N/wDBIv4+XfxI+DWq+BdXumudS8HTRpaySMSzWUoYxjPfYyOvsNtfjt4ltYrHxFqtvC6yww3c0aOvRlDkAj8q+8P+CMF9PH+0R4ws1fFtN4YklkTHVkurcKfwDt+dAI98/wCC1X/JFPh9/wBjG3/pLLX5A1+v3/Bar/kinw+/7GNv/SWWvx/k4jb6UAz9GP2B/wDgmxofxs8A23xE+Jc98ujagzDSdHspfJaeNSQZpXwTtJB2quMgZz0Fbf7eX/BNLwh8I/hLffEP4aPf2kejbH1PSby489HgZgpkjYjcGUkEg5BBPTFfoH+yLaw2P7MPwvht41hiXQLQhFGAMxgn9Sar/tkxrN+yr8VFbp/YF0fyTNAH86dftl/wSF8ZXPib9lN9MuHeQaBrdzYRFznEbKk4Uew80ivxMX7o+lfsh/wRf/5N08Yf9jVL/wCkltQJH6A0UUUFBRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABXx/b/8ABSTwH4Z+PnjP4Y/EFD4Tl0bUms7HWjmS0uEwpHmkDMTc+6n1FfYFfz2/t9Wstn+2J8U1njaIyau0ib1I3K0aEEeowaAP398N+KtF8ZabHqOg6tZa1YSDK3On3CTRnP8AtKSKtatq1joenz32pXkGn2MC75bq6kWKKNfVmYgAfWv5jNE8Tax4am87SNWvtKlwRvsrl4Tg9RlSKta5468S+JrdYNY8Q6rqsCnKx3t7LMoz14ZjQK57L+3n8RPCnxS/ao8a+IfBjxXGiTSRRC8gXal3LHGqSTL6gsOvfGe9eZfBPQ7vxJ8ZPAul2EXnXl1rlkkSep89D/IGuNjjeaRIo0aSRztVEGST6ADrX6nf8Eyf2C9c8L+JLP4u/ETTpNJnt4ydB0W6TbOGYY+1SqeV+UnYp553HGBQI+k/+Cnfw3ufiN+yL4o+wwG4vNDlh1hEVdzbIm/eY/4AzE+wNfg5X9RGoWFvqljc2V3BHc2lzG0M0Mi5WRGBDKR3BBI/Gvwy/bk/YM8Sfs3eLL/XvD9hcav8NbyYyWt9CpkbTtxz5E+PugZwrnhhjvQNn27/AMEkv2gtD8WfA+L4aXN9Db+KfDc0pis5GCvc2jsXWSMfxbSWVupGATwa+9ZJkhjeR2CIgyzMcAAdSfav5fNL1a90W+gv9NvLiwvYW3xXNrK0ciN6qynIP0rufEH7RXxU8WaPJpWtfEjxXqulyDbJZ3ms3EsTj0ZWfB/GgLnvH/BTz49aR8cv2jGTw7eR6joXhqzGlQ3kJDRzS7i8zIR1UMdoPfaa8D+AHw9vPir8bPBPhWyiaaXUdVt0cKM7Yg4aRj7BFY1xWk6Ve65qVvp2m2c+oX9w4jhtbWMySyMTgKqgZJJ9K/ZD/gmv+wlf/Ae1m+Ifj21WDxvqEHk2Wmkhjplu3LbyOPNfgED7oyOpNAj7smhW30ySJOEjhKL9AuBX8vM3+uk/3j/Ov6ir7/jyuP8Arm38jX8us3+uk/3j/OgbP0o/4Im/8j38T/8AsG2n/o16+0v+CkFhJqH7FnxMWJGkeO2tptqDPC3cJY/QDJ/Cvi3/AIIm/wDI9/E//sG2n/o16/UX4keB7D4mfD/xH4T1QZ0/WrCawmIGSqyIV3D3Gcj3AoBH8ytfs5/wR/8AiZpWv/s53ng5buMa34e1Sd5bQsA/2eciRJAO67i657FfcV+S3xh+EviL4H/ETWPBviize11PTpmj3lSEuI8/JLGf4kYYII9cdqwvC/i7XPBGsRat4d1nUNC1SIER3mm3L28yg9QHQg0CP6Ovjr8WtC+CPwr8ReLvEF5Ha2ljaSNGjOA9xMVIjiQHqzNgAfj0FfzaXl1JfXk91MQZp5GlcgYBZiSf1Ne5fDPwn8X/ANt34i6b4Ym8Sa74oNv+9uNQ1q9murfTYP4pGLkhfYDljwK8T1ixGl6vfWQfzRbXEkAcjG7axXP6UAfop/wRT/5KZ8Sf+wRb/wDo6v1uFfkj/wAEU/8AkpnxJ/7BFv8A+jq/W6gaP56f28Y2j/bE+LAZSu7WnYZHUGNMGt7/AIJv+KNN8J/tjeA7nVLlLS3uXnsklkICiWWJlQEnplsD6kV6/wD8FcPgDq3g742f8LLtbSSbwx4lhijnuo1JS2vI12MjntvUKwz1+Ydq+Ckdo3VkZkdTlWU4II7j3oGf1G7u9fIX/BVr/ky3xR/2ENO/9Ko6/MP9mH45/Ebxj+0d8H9E17x74l1rRl8Uaao0+/1aeaDAnQAbGYjj6V+nv/BVz/ky3xT/ANhDTv8A0qjoEz8L6/eD/gl//wAmY+C/+ut3/wCj3r8H6/eD/gl//wAmY+C/+ut3/wCj3oEj89P+Ct3w5ufCP7VEviHyNmn+J9Nt7uGRVwpkiUQyrnu2UVj/AL4r5c+CnxGf4R/Fzwf40SIz/wBh6pBevCMZkjVxvUZ7ldw/Gv3W/bX/AGUdP/at+E76MssVh4n012u9F1CQfKk2MNG5/uOAAfTAPavwf+Jvwt8VfBzxZd+G/GOi3Wh6xbOVaG4QgOAcB426Oh7MpINAH9IngDx9oPxQ8I6b4m8M6lDq2i6hEJoLmBgQQRna391h0KnkEVxH7T3x40X9nf4OeIPFeq30Vtdx20kWm27MPMursqREiL3+YgnHQAmv58/BPxa8b/DVZV8JeL9c8MrNzIuk6jNbK/1CMAfxqp4y+Inin4iXyX3irxJq3iS8jXalxq17Jcuo9AXYkCgdzBmme4mklk+/IxdvqTk1+ov/AARV+G91GfiH4+niKWkqwaLaSEffYEyzY46D90OD1z6V8Jfs5fsv+Of2nfGEOjeEtNkNiki/b9anQi0sYyeWd+hbHRB8x+mSP35+Bvwc0H4CfC7QvBHh2PGn6XDsMzAB55TzJK3+0zEn9KAR8U/8Fqv+SKfD7/sY2/8ASWWvx/k/1bfQ1+wH/Bar/kinw+/7GNv/AEllr8f5P9W30NAH9Hf7J/8AybP8Mf8AsX7P/wBFiqn7Yn/JrPxT/wCxfu//AEA1b/ZP/wCTZ/hj/wBi/Z/+ixVX9sTn9ln4p/8AYv3f/os0DP5z1+6PpX7If8EX/wDk3Txh/wBjVL/6SW1fjev3R9K/ZD/gi/8A8m6eMP8Asapf/SS2oJR+gNFFFBQUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAVxHxI+CPgL4v2v2fxp4R0nxGgG1XvrVWkQeiyfeUfQ129FAHyLrn/AASr/Z31q6My+GNQ0zOf3en6rNGnJz0JNZ1j/wAElP2e7ORXfStdu9rbts2sS7T7EDGRX2XRQB5B8Lf2Rfg/8GbmO78JeA9J0/UI+Vv5IvPuFPqHkLFT7jFev0UUAFRXVrDfW8lvcRJPBIpSSKRQyupGCCDwQfSpaKAPmn4if8E5/gD8SL6W9vfA0OlXkzbpJtEney3HP91DtH4CuHtv+CSP7PlvcGR9M164XIIik1iTaPbgAmvs6igDy/4SfsxfC74F/P4J8F6Zot2Rta+WLzLlh3/evlufQGvUKKKAGyIJI2RhlWGCPavn1v8Agn3+zs7Fm+FOiEk5PMv/AMXX0JRQB5t8Kf2b/hp8Dby/u/AfhCw8M3F/GsV1JZ78yqpJUHcx6EmvSaKKAPOfjF+zv8PPj5psdl478L2WuiEEQXEilJ4M/wByRcMPpnHtXz3D/wAElv2e4b4TnSdckQEEW76xKY+D37kfjX2VRQBxnwx+Dfgv4M+HBoXgvw7Y+HtMPMkVpHhpT/ekc/M59yTXmdz+wL+z3eXU1xN8K9EkmmdpHc+blmJyT9/1r3+igDzb4U/s3/DP4H31/e+BPB9h4Zur6NYbmWz35lRTkKdzHjPNek0UUAZXijwro/jbQbvRdf0y11jSbtNk9lexLLFIvupH/wCqvlXxJ/wSm/Z78QahNdxeH9U0ZpG3eTpuqSxxL7BTnFfX9FAHzT8Kf+CdfwM+Dviix8RaJ4YnutasJluLS71O+luGt5VIKuoJwCCMjivb/iL8M/DHxb8K3Hhrxho1vr+hXDpJLY3W7Y7IwZScEHggGunooA+e/wDh33+zsOR8KNE/OX/4uvYfh98OvDfwp8K2vhvwlpEGh6FalmhsbbOxCzFmxkk8kk9a6OigArkfiN8I/Bnxe0gaZ408M6b4kslztjv4A5TPUo33lP8AukV11FAHx5rX/BKD9nrWLiWaPQdW0wuciOx1aVUX6Kc1o+Ef+CXP7PPhO+S6PhO61t1wQmr6hLPHkd9uQK+sqKAMrwv4T0XwTo0GkeH9Ks9F0uAYis7CBYYl+iqAM+/U1q0UUAcT8Vfgn4G+OGj2el+O/Ddn4l0+zn+0wQXm7bHLtK7htI5wSPxrzD/h3z+zr/0SjRPzm/8Ai6+haKAM3w34c03whoGn6Jo1nHp+lafCtva2sWdsUajCqM84ApvijwxpfjTw7qGha3ZR6jpGoQtb3VpNnZNGwwynBzg1qUUAfPf/AA77/Z2/6JRof/kX/wCLr1D4V/BjwT8EdEutH8C+HbTw1pl1cG7mtrPdteYqqFzuJ52oo/Cu0ooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/Z" alt="Healthspan logo" onerror="this.style.display='none';">
  <div class="company-name">HEALTHSPAN</div>
</div>
</header>
<div class="wrap">
  <div class="toolbar">
    <button id="clearBtn" class="btn">Clear All</button>
  </div>
  <div id="dbg"></div>
  <div id="err"></div>
  <h1>Mobility Age ‚Äî v9.27</h1>
  <p class="note">Capped MAEs: Sit &amp; Reach ‚â• 21, TUG ‚â• 21, VO‚ÇÇ ‚â• 21. Auto-calc every 0.5s after all fields are filled.</p>
  <div class="card">
    <h2>Inputs</h2>
    <div class="grid-2">
      <div>
        <div class="row"><label>Tester</label><input id="tester" placeholder="e.g., Jane Doe"></div>
        <div class="row"><label>Test Date</label><input id="testDate" type="date"></div>
        <div class="row"><label>Location</label><input id="location" placeholder="e.g., Clinic A"></div>
        <div class="row"><label>Member Name</label><input id="memberName" placeholder="e.g., John Smith"></div>
        <div class="row"><label>Phone (xxx-xxx-xxxx)</label><input id="phone" placeholder="555-123-4567"></div>
      </div>
      <div>
        <div class="row"><label>Sex</label>
          <select id="sex">
            <option value="" selected disabled>‚Äî Select ‚Äî</option>
            <option>Male</option>
            <option>Female</option>
          </select>
        </div>
        <div class="row"><label>Age</label><input id="age" type="number" min="1" placeholder="Age in years"></div>
      </div>
    </div>
    <h3>Tests</h3>
    <div class="grid-2">
      <div>
        <div class="row"><label>Sit &amp; Reach (in)</label><input id="sit" type="number" step="0.01" placeholder="inches"></div>
        <div class="row"><label>TUG (sec)</label><input id="tug" type="number" step="0.01" placeholder="seconds"></div>
        <div class="row"><label>Mid-Thigh Pull (percentile)</label><input id="mtp" type="number" min="0.01" max="99.99" step="0.01" placeholder="0.01‚Äì99.99"></div>
      </div>
      <div>
        <div class="row"><label>Postural Sway Right (percentile)</label><input id="sway_r" type="number" min="0.01" max="99.99" step="0.01" placeholder="0.01‚Äì99.99"></div>
        <div class="row"><label>Postural Sway Left (percentile)</label><input id="sway_l" type="number" min="0.01" max="99.99" step="0.01" placeholder="0.01‚Äì99.99"></div>
        <div class="row"><label>Grip Strength Right (percentile)</label><input id="grip_r" type="number" min="0.01" max="99.99" step="0.01" placeholder="0.01‚Äì99.99"></div>
        <div class="row"><label>Grip Strength Left (percentile)</label><input id="grip_l" type="number" min="0.01" max="99.99" step="0.01" placeholder="0.01‚Äì99.99"></div>
        <div class="row"><label>VO‚ÇÇ Max (mL/kg/min)</label><input id="vo2" type="number" step="0.01" placeholder="ml/kg/min"></div>
      </div>
    </div>
  </div>
  <div id="results" class="card" style="margin-top:14px;">
    <h2>Results</h2>
    <div id="who"></div>
    <table><thead><tr><th>Test</th><th>Z</th><th>Weight</th><th>Weighted Z</th><th>MAE</th></tr></thead>
      <tbody id="rows"></tbody>
      <tfoot><tr><th colspan="4">Final Mobility Age</th><th id="final"></th></tr></tfoot>
    </table>
  </div>
</div>

<script id="sr_json" type="application/json">{"Male": {"20-29": {"mean": 15.0, "sd": 3.0, "mid": 24.5}, "30-39": {"mean": 14.0, "sd": 3.0, "mid": 34.5}, "40-49": {"mean": 13.0, "sd": 3.0, "mid": 44.5}, "50-59": {"mean": 12.0, "sd": 3.0, "mid": 54.5}, "60-69": {"mean": 11.0, "sd": 3.0, "mid": 64.5}, "70-79": {"mean": 10.0, "sd": 3.0, "mid": 74.5}, "80-89": {"mean": 9.0, "sd": 3.0, "mid": 84.5}}, "Female": {"20-29": {"mean": 17.0, "sd": 3.0, "mid": 24.5}, "30-39": {"mean": 16.0, "sd": 3.0, "mid": 34.5}, "40-49": {"mean": 15.0, "sd": 3.0, "mid": 44.5}, "50-59": {"mean": 14.0, "sd": 3.0, "mid": 54.5}, "60-69": {"mean": 13.0, "sd": 3.0, "mid": 64.5}, "70-79": {"mean": 12.0, "sd": 3.0, "mid": 74.5}, "80-89": {"mean": 11.0, "sd": 3.0, "mid": 84.5}}}</script>
<script id="tug_json" type="application/json">{"Male": {"20-29": {"mean": 6.0, "sd": 1.0, "mid": 24.5}, "30-39": {"mean": 7.0, "sd": 1.0, "mid": 34.5}, "40-49": {"mean": 8.0, "sd": 1.0, "mid": 44.5}, "50-59": {"mean": 9.0, "sd": 1.0, "mid": 54.5}, "60-69": {"mean": 10.0, "sd": 1.0, "mid": 64.5}, "70-79": {"mean": 11.0, "sd": 1.0, "mid": 74.5}, "80-89": {"mean": 12.0, "sd": 1.0, "mid": 84.5}}, "Female": {"20-29": {"mean": 6.5, "sd": 1.0, "mid": 24.5}, "30-39": {"mean": 7.5, "sd": 1.0, "mid": 34.5}, "40-49": {"mean": 8.5, "sd": 1.0, "mid": 44.5}, "50-59": {"mean": 9.5, "sd": 1.0, "mid": 54.5}, "60-69": {"mean": 10.5, "sd": 1.0, "mid": 64.5}, "70-79": {"mean": 11.5, "sd": 1.0, "mid": 74.5}, "80-89": {"mean": 12.5, "sd": 1.0, "mid": 84.5}}}</script>
<script id="vo2_json" type="application/json">{"Male": {"20-29": {"mean": 50.0, "sd": 5.0, "mid": 24.5}, "30-39": {"mean": 46.0, "sd": 5.0, "mid": 34.5}, "40-49": {"mean": 42.0, "sd": 5.0, "mid": 44.5}, "50-59": {"mean": 38.0, "sd": 5.0, "mid": 54.5}, "60-69": {"mean": 34.0, "sd": 5.0, "mid": 64.5}, "70-79": {"mean": 30.0, "sd": 5.0, "mid": 74.5}, "80-89": {"mean": 26.0, "sd": 5.0, "mid": 84.5}}, "Female": {"20-29": {"mean": 40.0, "sd": 4.5, "mid": 24.5}, "30-39": {"mean": 36.5, "sd": 4.5, "mid": 34.5}, "40-49": {"mean": 33.0, "sd": 4.5, "mid": 44.5}, "50-59": {"mean": 29.5, "sd": 4.5, "mid": 54.5}, "60-69": {"mean": 26.0, "sd": 4.5, "mid": 64.5}, "70-79": {"mean": 22.5, "sd": 4.5, "mid": 74.5}, "80-89": {"mean": 19.0, "sd": 4.5, "mid": 84.5}}}</script>
<script id="slopes_json" type="application/json">{"sit_reach": 0.0, "tug": 0.0, "vo2": 0.0}</script>

<script>
(function(){
  var t=0;
  

  function parseJ(id){ var el=document.getElementById(id); try{ return JSON.parse(el.textContent); }catch(e){ return {}; } }
  var SIT = parseJ('sr_json'), TUG = parseJ('tug_json'), VO2 = parseJ('vo2_json'), SLP = parseJ('slopes_json');

  var ok = document.getElementById('ok');
  if(ok){
    function c(g){ return [Object.keys(g.Male||{}).length, Object.keys(g.Female||{}).length]; }
    var cs = c(SIT), ct = c(TUG), cv = c(VO2);
    ok.textContent = 'Script loaded. Norm bins ‚Äî SR ' + cs[0] + ' / ' + cs[1] + ', TUG ' + ct[0] + ' / ' + ct[1] + ', VO2 ' + cv[0] + ' / ' + cv[1];
  }

  function parseRange(label){
    if(!label) return null;
    var s = label.toString().trim();
    s = s.replace(/[\u2013\u2014]/g,'-');
    var m = s.match(/(\d+)\s*-\s*(\d+)/);
    if(m) return [parseInt(m[1],10), parseInt(m[2],10)];
    m = s.match(/(\d+)\D+(\d+)/);
    if(m) return [parseInt(m[1],10), parseInt(m[2],10)];
    m = s.match(/(\d+)\s*\+$/);
    if(m) return [parseInt(m[1],10), parseInt(m[1],10)+9];
    m = s.match(/(\d+)/);
    if(m) return [parseInt(m[1],10), parseInt(m[1],10)];
    return null;
  }

  function pickAgeGroup(age, node){
    var keys = Object.keys(node||{});
    var best = null, bestDist = Infinity;
    for(var i=0;i<keys.length;i++){
      var k = keys[i];
      var r = parseRange(k);
      if(!r) continue;
      var mid = (r[0] + r[1]) / 2;
      if(age >= r[0] && age <= r[1]){
        return {label:k, mid:mid, r:r};
      }
      var d = Math.abs(age - mid);
      if(d < bestDist){
        bestDist = d; best = {label:k, mid:mid, r:r};
      }
    }
    return best;
  }

  function normSInv(p){
    if(!(p>0 && p<1)){ return NaN; }
    var a=[-39.69683028665376,220.9460984245205,-275.9285104469687,138.3577518672690,-30.66479806614716,2.506628277459239];
    var b=[-54.47609879822406,161.5858368580409,-155.6989798598866,66.80131188771972,-13.28068155288572];
    var c=[-0.007784894002430293,-0.3223964580411365,-2.400758277161838,-2.549732539343734,4.374664141464968,2.938163982698783];
    var d=[0.007784695709041462,0.3224671290700398,2.445134137142996,3.754408661907416];
    var plow=0.02425, phigh=1-plow, q, r;
    if(p<plow){
      q = Math.sqrt(-2*Math.log(p));
      var num = (((((c[0]*q + c[1])*q + c[2])*q + c[3])*q + c[4])*q + c[5]);
      var den = ((((d[0]*q + d[1])*q + d[2])*q + d[3])*q + 1);
      return num/den;
    } else if (p>phigh){
      q = Math.sqrt(-2*Math.log(1-p));
      var num2 = (((((c[0]*q + c[1])*q + c[2])*q + c[3])*q + c[4])*q + c[5]);
      var den2 = ((((d[0]*q + d[1])*q + d[2])*q + d[3])*q + 1);
      return -num2/den2;
    } else {
      q = p - 0.5;
      r = q*q;
      var num3 = (((((a[0]*r + a[1])*r + a[2])*r + a[3])*r + a[4])*r + a[5]) * q;
      var den3 = (((((b[0]*r + b[1])*r + b[2])*r + b[3])*r + b[4])*r + 1);
      return num3/den3;
    }
  }

  function zFromRaw(raw, mean, sd, invert){
    if(!isFinite(sd) || sd===0){ return 0; }
    var z=(raw-mean)/sd;
    if(invert){ z = -z; }
    return z;
  }
  function zFromPct(p){ return normSInv(p/100); }
  function clamp(x,lo,hi){ if(x<lo) return lo; if(x>hi) return hi; return x; }

  function requiredFilled(){
    var age = document.getElementById('age').value.trim();
    var sex = document.getElementById('sex').value.trim();
    var ids = ['sit','tug','mtp','sway_r','sway_l','grip_r','grip_l','vo2'];
    if(!(age && sex)) return false;
    for(var i=0;i<ids.length;i++){
      var v = document.getElementById(ids[i]).value.trim();
      if(!v) return false;
    }
    return true;
  }

// ...
function clearAll(){
  // Clear input controls (safe if some IDs don't exist)
  var ids = [
    'tester','location','memberName','firstName','lastName',
    'phone','age','sit','tug','mtp','sway_r','sway_l','grip_r','grip_l','vo2'
  ];
  for (var i = 0; i < ids.length; i++) {
    var el = document.getElementById(ids[i]);
    if (el) el.value = '';
  }

  // Clear rows + final number
  var tbody = document.getElementById('rows');  if (tbody) tbody.innerHTML = '';
  var fin   = document.getElementById('final'); if (fin)   fin.textContent = '';

  // Clear the summary (‚ÄúMember: ‚Ä¶ ‚Ä¢ Age: ‚Ä¶ ‚Ä¢ Sex: ‚Ä¶‚Äù)
  var summary =
    document.getElementById('who') ||
    document.querySelector('#results .readout') ||
    document.querySelector('[data-summary]');
  if (summary) summary.textContent = '';

  // Optional: refresh UI if your app exposes render()
  if (typeof render === 'function') render();
}

window.__clearAll = clearAll;
// ...



  function render(){
    var dbg = document.getElementById('dbg'), errBox = document.getElementById('err');
    try{
      var fin = document.getElementById('final');
      var tbody = document.getElementById('rows');
      if(!requiredFilled()){
        if(tbody){ tbody.innerHTML=''; }
        if(fin){ fin.textContent=''; }
        if(dbg){ dbg.textContent='Fill all fields to calculate.'; }
        return;
      }

      var sex = document.getElementById('sex').value;
      var age = Number(document.getElementById('age').value)||0;
      function num(id){ var v = Number(document.getElementById(id).value); return isFinite(v)?v:0; }
      var sit=num('sit'), tugRaw=num('tug'), mtpPct=num('mtp'), vo2Raw=num('vo2');
      var sway_r_pct=clamp(num('sway_r'),0.0001,99.9999), sway_l_pct=clamp(num('sway_l'),0.0001,99.9999);
      var grip_r_pct=clamp(num('grip_r'),0.0001,99.9999), grip_l_pct=clamp(num('grip_l'),0.0001,99.9999);

      var srPick=pickAgeGroup(age,(SIT[sex]||{}));
      var tgPick=pickAgeGroup(age,(TUG[sex]||{}));
      var v2Pick=pickAgeGroup(age,(VO2[sex]||{}));

      function nodeFor(pick, map){ if(!pick) return {mean:0,sd:1,mid:0}; var d = map[pick.label]||{}; return {mean:d.mean||0, sd:d.sd||1, mid:(d.mid!=null?d.mid:pick.mid)}; }
      var sr = nodeFor(srPick, SIT[sex]||{}), tg = nodeFor(tgPick, TUG[sex]||{}), v2 = nodeFor(v2Pick, VO2[sex]||{});

      var srSlope = (SLP && SLP.sit_reach)?SLP.sit_reach:0;
      var tgSlope = (SLP && SLP.tug)?SLP.tug:0;
      var v2Slope = (SLP && SLP.vo2)?SLP.vo2:0;

      // 1) slope-adjusted means
var srMeanAdj = sr.mean + srSlope*(age - sr.mid);
var tgMeanAdj = tg.mean + tgSlope*(age - tg.mid);
var v2MeanAdj = v2.mean + v2Slope*(age - v2.mid);

// 2) Z-score cap (VO2 & TUG only) ‚Äî add once
const ZCAP = 2.5;  // use 3.0 if you prefer
function capZ(z, cap = ZCAP){ return Math.max(-cap, Math.min(z, cap)); }

// 3) z-scores
var z_sit   = zFromRaw(sit,    srMeanAdj, sr.sd, false);
var z_tug_raw = zFromRaw(tugRaw, tgMeanAdj, tg.sd, true);   // TUG: lower=better handled by helper
var z_vo2   = zFromRaw(vo2Raw, v2MeanAdj, v2.sd, false);
var z_mtp   = zFromPct(mtpPct);
var z_sway  = zFromPct((sway_r_pct + sway_l_pct)/2.0);
var z_grip  = zFromPct((grip_r_pct + grip_l_pct)/2.0);

// 4) apply caps only to TUG and VO2
var z_tug = capZ(z_tug_raw);
z_vo2 = capZ(z_vo2);

// 5) weights (unchanged)
var w  = { sit:1.0, tug:1.25, mtp:1.0, sway:1.0, grip:1.0, vo2:1.5 };

// 6) weighted z (use capped values)
var wz = {
  sit:  z_sit * w.sit,
  tug:  z_tug * w.tug,
  mtp:  z_mtp * w.mtp,
  sway: z_sway * w.sway,
  grip: z_grip * w.grip,
  vo2:  z_vo2 * w.vo2
};


      // Apply MAE caps (>=21) for Sit & Reach, TUG, and VO2
      var mae={ 
        sit:Math.max(21, age-15*wz.sit), 
        tug:Math.max(21, age-15*wz.tug), 
        mtp:age-15*wz.mtp, 
        sway:age-15*wz.sway, 
        grip:age-15*wz.grip, 
        vo2:Math.max(21, age-15*wz.vo2) 
      };

      var final=(mae.sit+mae.tug+mae.mtp+mae.sway+mae.grip+mae.vo2)/6.0;

      var who = document.getElementById('who');
      if(who){ who.textContent='Member: '+(document.getElementById('memberName').value||'(No name)')+' ‚Ä¢ Age: '+age+' ‚Ä¢ Sex: '+sex; }
      if(tbody){
        tbody.innerHTML = ''
          + '<tr><td>Sit & Reach (in)</td><td>'+z_sit.toFixed(2)+'</td><td>'+w.sit.toFixed(2)+'</td><td>'+wz.sit.toFixed(2)+'</td><td>'+mae.sit.toFixed(2)+'</td></tr>'
          + '<tr><td>TUG (MAE floor ‚â•21; z capped ¬±'+ZCAP+')</td><td>'+z_tug.toFixed(2)+'</td><td>'+w.tug.toFixed(2)+'</td><td>'+wz.tug.toFixed(2)+'</td><td>'+mae.tug.toFixed(2)+'</td></tr>'
          + '<tr><td>Mid-Thigh Pull</td><td>'+z_mtp.toFixed(2)+'</td><td>'+w.mtp.toFixed(2)+'</td><td>'+wz.mtp.toFixed(2)+'</td><td>'+mae.mtp.toFixed(2)+'</td></tr>'
          + '<tr><td>Postural Sway (avg R/L pct)</td><td>'+z_sway.toFixed(2)+'</td><td>'+w.sway.toFixed(2)+'</td><td>'+wz.sway.toFixed(2)+'</td><td>'+mae.sway.toFixed(2)+'</td></tr>'
          + '<tr><td>Grip Strength (avg R/L pct)</td><td>'+z_grip.toFixed(2)+'</td><td>'+w.grip.toFixed(2)+'</td><td>'+wz.grip.toFixed(2)+'</td><td>'+mae.grip.toFixed(2)+'</td></tr>'
          + '<tr><td>VO‚ÇÇ Max</td><td>'+z_vo2.toFixed(2)+'</td><td>'+w.vo2.toFixed(2)+'</td><td>'+wz.vo2.toFixed(2)+'</td><td>'+mae.vo2.toFixed(2)+'</td></tr>';
      }
      if(fin){ fin.textContent = final.toFixed(2); }

      var dbg = document.getElementById('dbg');
      if(dbg){
        var txt='Picked bins:\n';
        txt += '  SR: ' + (srPick?srPick.label:'(none)') + ' mid=' + (sr.mid) + ' mean=' + sr.mean + ' sd=' + sr.sd + '\n';
        txt += '  TUG: ' + (tgPick?tgPick.label:'(none)') + ' mid=' + (tg.mid) + ' mean=' + tg.mean + ' sd=' + tg.sd + '\n';
        txt += '  VO2: ' + (v2Pick?v2Pick.label:'(none)') + ' mid=' + (v2.mid) + ' mean=' + v2.mean + ' sd=' + v2.sd + '\n';
        dbg.textContent = txt;
      }
      if(errBox){ errBox.style.display='none'; }
    }catch(e){
      if(errBox){
        errBox.style.display='block';
        errBox.textContent='Calc Error: '+ (e && e.message ? e.message : e);
      }
    }
  }

  // Hook up Clear button
  document.addEventListener('click', function(ev){
    if (ev.target && ev.target.id === 'clearBtn'){
      ev.preventDefault();
      clearAll();
    }
  });

  function clearAll(){
    // Inputs (safe to include ids that may not exist)
    var ids = [
      'tester','location','memberName','firstName','lastName',
      'phone','age','sit','tug','mtp','sway_r','sway_l','grip_r','grip_l','vo2','testDate','sex'
    ];
    for (var i=0;i<ids.length;i++){
      var el = document.getElementById(ids[i]);
      if (!el) continue;
      if (el.tagName === 'SELECT') el.selectedIndex = 0;
      else el.value = '';
    }

    // Results table + final number
    var tbody = document.getElementById('rows');  if (tbody) tbody.innerHTML = '';
    var fin   = document.getElementById('final'); if (fin)   fin.textContent = '';

    // Summary line (Member / Age / Sex)
    var summary =
      document.getElementById('who') ||
      document.querySelector('#results .readout') ||
      document.querySelector('[data-summary]');
    if (summary) summary.textContent = '';

    // Refresh the UI if present
    if (typeof render === 'function') render();
  }
  window.__clearAll = clearAll;

  // Start empty (except date)
  function startEmpty(){
    clearAll();
    var td = document.getElementById('testDate');
    if (td){ try{ td.value = new Date().toISOString().slice(0,10); }catch(e){} }
  }
  startEmpty();

  // Render timer
  setInterval(render, 500);
})();  
</script>  

<!-- Mobility Age App ‚Ä¢ v9.27 ‚Ä¢ Build 2025-09-04 ‚Ä¢ Branded (logo embedded) ‚Ä¢ Clean (no debug) -->
  <!--
<!--
HSMI Data Export Add‚Äëon (v5.2.1)
- Hardened: single‚Äëblock enforcement, safer wiring, readable console logs
- Embedded mapping (works on any device), fixed headers, local timestamp only
- Hides all mapping buttons when an embedded map is present
- Forces local US date for <input id="testDate" type="date">

Drop this whole block just before 
<style>
@media print {
  /* Force header + brandbar visible even if marked 'no-print' earlier */
  html body header { display: block !important; background: none !important; border: 0 !important; padding: 0 0 6px !important; }
  html body .brandbar { display: flex !important; align-items: center !important; gap: 8px !important; margin: 0 0 6px !important; }
  html body .brandbar.no-print { display: flex !important; } /* override earlier .no-print hide */
  html body .brandbar img { height: 28px !important; width: auto !important; border-radius: 6px !important; }
  html body .brandbar .company-name { font-weight: 900 !important; font-size: 11pt !important; letter-spacing: .2px !important; }

  /* Keep only the action toolbar hidden, not the whole header */
  .toolbar, .toolbar * , button, .btn { display: none !important; }

  /* Prevent orphan title; keep next content with it */
  h1, main h1, .brandbar {
    break-after: avoid-page !important;
    page-break-after: avoid !important;
    margin-bottom: 6px !important;
  }
  /* Pull first substantive content up */
  #controls, #inputs, #final, #results, #summary, main > section:first-of-type, fieldset:first-of-type {
    break-before: avoid-page !important;
    page-break-before: avoid !important;
    margin-top: 0 !important;
  }

  /* Safety: never hide main content */
  main { display: block !important; }
}
</style>


<style>
@media print {
  /* --- Ensure the first page is not blank --- */
  html, body { margin:0 !important; padding:0 !important; height:auto !important; }
  body, main, .wrap { position:static !important; min-height:auto !important; }

  /* Show the print cover and keep it with the next block */
  #print-cover{ display:block !important; margin:0 0 8mm !important; color:#000 !important; }
  #print-cover .print-title{ font-size:18pt !important; font-weight:900 !important; margin:0 0 2mm !important; }
  #print-cover .print-company{ font-size:11pt !important; font-weight:700 !important; }

  /* Do NOT hide the app hero h1 in case you want it on screen; we only add a small print cover.
     But avoid double spacing by tightening the next element. */
  .wrap > * { page-break-before:auto !important; break-before:auto !important; margin-top:0 !important; }

  /* Keep important blocks intact */
  section, fieldset, .card, table, tr, td, th {
    page-break-inside:avoid !important; break-inside:avoid !important;
  }
  section, fieldset, .card { border:1px solid #000 !important; box-shadow:none !important; }
  table { width:100% !important; border-collapse:collapse !important; }
  th, td { border:1px solid #000 !important; padding:6px 8px !important; }

  /* Hide UI chrome + most floating badges */
  .toolbar, .btn, button, #dbg, #err, .note { display:none !important; visibility:hidden !important; }
  [style*="position:fixed"], [style*="position: fixed"],
  [style*="position:sticky"], [style*="position: sticky"],
  [class*="badge"], [class*="toast"], [class*="fab"], [class*="float"],
  [class*="csv"], [id*="csv"], [data-csv], [data-csv-batch] { 
    display:none !important; visibility:hidden !important;
  }

  @page { size: Letter portrait; margin:10mm; }
  *, *::before, *::after { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
}
</style>

<style>
@media print{
  #print-cover{ padding:0 0 4mm !important; }
  #print-cover .print-cover-brand{ display:flex !important; align-items:center !important; gap:12px !important; margin:0 0 3mm !important; }
  #print-cover #print-cover-logo{ height:38px !important; width:auto !important; border-radius:6px !important; }
  #print-cover .print-cover-titles{ display:flex; flex-direction:column; gap:1mm; }
  #print-cover .print-meta{ display:grid !important; grid-template-columns:1fr 1fr !important; gap:2mm 8mm !important; font-size:10pt !important; margin:0 0 3mm !important; }
  #print-cover .print-meta .k{ display:inline-block; min-width:70px; color:#6b7280; font-weight:700; }
  #print-cover .print-meta .v{ color:#111827; font-weight:600; }
  #print-cover .print-intro{ margin:0 !important; font-size:10.5pt !important; line-height:1.5 !important; color:#374151 !important; }
}
</style>

<script>
// Remove any CSV badge / floating pill and rogue min-heights before printing
(function(){
  function killCsvAndFloaters(){
    try{
      // text-based
      const all = Array.from(document.querySelectorAll('body *'));
      all.forEach(el => {
        const t = (el.textContent || '').toLowerCase();
        if (t.includes('csv batch') || t === 'csv' || t.includes('csv')) {
          el.style.display = 'none'; el.style.visibility = 'hidden';
        }
        // position-based floaters
        const cs = getComputedStyle(el);
        if (['fixed','sticky'].includes(cs.position)) {
          el.style.display = 'none'; el.style.visibility = 'hidden';
        }
        // strong inline overrides causing blank first page
        if (cs.minHeight && cs.minHeight !== 'auto' && cs.minHeight !== '0px') {
          el.style.minHeight = 'auto';
        }
        if (cs.position === 'relative' && (cs.top !== 'auto' || cs.top === '0px')) {
          el.style.position = 'static';
          el.style.top = 'auto';
        }
      });
    }catch(e){}
  }
  function ensureTop(){ try{ window.scrollTo(0,0); }catch(e){} }
  window.addEventListener('beforeprint', function(){
    killCsvAndFloaters();
    ensureTop();
  });
})();
</script>


<!-- Paste mapping JSON here when ready -->
<script type="application/json" id="hsmi_embedded_map">{  "age": {
    "type": "id",
    "value": "age"
  },
  "sex": {
    "type": "id",
    "value": "sex"
  },
  "vo2_mlkgmin": {
    "type": "id",
    "value": "vo2"
  },
  "mtp_pct": {
    "type": "id",
    "value": "mtp"
  },
  "grip_r_pct": {
    "type": "id",
    "value": "grip_r"
  },
  "grip_l_pct": {
    "type": "id",
    "value": "grip_l"
  },
  "sway_r_pct": {
    "type": "id",
    "value": "sway_r"
  },
  "sway_l_pct": {
    "type": "id",
    "value": "sway_l"
  },
  "sitreach_in": {
    "type": "id",
    "value": "sit"
  },
  "tester": {
    "type": "id",
    "value": "tester"
  },
  "location": {
    "type": "id",
    "value": "location"
  }
}</script>

<section id="hsmi-export-controls" class="export-controls" style="margin-top:1.5rem; display:grid; gap:0.5rem; grid-template-columns: repeat(auto-fit,minmax(200px,1fr));">
  <button id="btnExportCSV" class="btn">Download CSV</button>
  <button id="btnExportJSON" class="btn">Download JSON</button>
  <button id="btnProbe" class="btn">Test capture</button>
  <button id="btnAudit" class="btn">Audit selectors</button>
  <button id="btnCopyMap" class="btn">Copy mapping JSON</button>
  <button id="btnMap" class="btn">Map fields</button>
  <button id="btnClearMap" class="btn">Clear mapping</button>
  <button id="btnAuditMap" class="btn">Audit mapping</button>
</section>

<script>
(()=>{
  const NS = 'HSMI:';
  const log = (...a)=>console.log(NS,...a);
  const warn = (...a)=>console.warn(NS,...a);
  const err = (...a)=>console.error(NS,...a);

  // Enforce single instance (remove older #hsmi-export-controls / #export-controls blocks, keep the last)
  const allBlocks = document.querySelectorAll('#hsmi-export-controls, #export-controls');
  if (allBlocks.length>1) { allBlocks.forEach((b,i)=>{ if(i<allBlocks.length-1) b.remove(); }); }
  const host = document.querySelector('#hsmi-export-controls') || document.querySelector('#export-controls');
  if(!host){ err('export controls block not found'); return; }

  if (window.__HSMI_EXPORT_WIRED__) { warn('already wired, skipping'); return; }

  // ===== CONSTANTS =====
  const STORAGE_KEY = 'hsmi_field_map_v3';
  const HEADERS = [
    'timestamp_local','app_version','name_full','tester','location','sex','age',
    'tug_s','vo2_mlkgmin','sitreach_in','mtp_pct','grip_r_pct','grip_l_pct','sway_r_pct','sway_l_pct','mobility_age'
  ];
  const MAP_KEYS_ORDER = ['age','sex','tester','location','vo2_mlkgmin','mtp_pct','grip_r_pct','grip_l_pct','sway_r_pct','sway_l_pct','sitreach_in'];

  // ===== EMBEDDED MAP =====
  function getEmbeddedMap(){
    try{ const el=document.getElementById('hsmi_embedded_map'); if(!el) return {}; const txt=(el.textContent||'').trim(); if(!txt) return {}; const m=JSON.parse(txt); return (m && typeof m==='object')? m : {}; } catch(e){ err('Embedded map JSON parse error:', e.message); return {}; }
  }
  const EMBEDDED_MAP = getEmbeddedMap();

  // ===== CONFIG =====
  const CONFIG = {
    filenamePattern:'mobility-age_{last}_{date}_{time}',
    timeZone: 'America/New_York', // force a single US timezone for local timestamp/date; change if needed
    selectors:{ name:'#memberName', sex:'#input-sex', age:'#input-age', tug_s:'#tug', tester:null, location:null }
  };

  // ===== UTILS =====
  const $ = (s)=> s? document.querySelector(s): null;
  const text = (el)=> el? (('value' in el && el.value!=null)? String(el.value): String(el.textContent||'')).trim(): '';
  const numFirst = (t)=>{ if(t==null) return ''; const m=String(t).match(/-?\d+(?:[.,]\d+)?/); if(!m) return ''; const v=Number(m[0].replace(',','.')); return Number.isFinite(v)? v:''; };
  const numFrom = (el)=> numFirst((el && (el.dataset?.value||el.dataset?.num)) || text(el));
  const nowParts=()=>{ const d=new Date(),p=n=>String(n).padStart(2,'0'); return {date:`${d.getFullYear()}-${p(d.getMonth()+1)}-${p(d.getDate())}`, time:`${p(d.getHours())}${p(d.getMinutes())}`}; };
  const parseName=(full)=>{ const t=(full||'').trim(); if(!t) return {first:'',last:''}; const a=t.split(/[\s,]+/).filter(Boolean); return a.length===1?{first:a[0],last:''}:{first:a[0],last:a[a.length-1]}; };
  const slug=s=>(s||'').toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'');
  const buildFilename=(base)=>{ const {date,time}=nowParts(); const {first,last}=parseName(base?.name_full); return CONFIG.filenamePattern.replace('{first}',slug(first)).replace('{last}',slug(last)).replace('{date}',date).replace('{time}',time); };
  const downloadBlob=(content,mime,filename)=>{ const b=new Blob([content],{type:mime}); const a=document.createElement('a'); a.href=URL.createObjectURL(b); a.download=filename; document.body.appendChild(a); a.click(); setTimeout(()=>{URL.revokeObjectURL(a.href); a.remove();},0); };
  const toCSV=(rows)=>{ const esc=v=>{ if(v===null||v===undefined) return ''; const s=String(v); return /[",\n]/.test(s)? '"'+s.replace(/"/g,'""')+'"' : s; }; const lines=[HEADERS.join(',')]; for(const r of rows){ lines.push(HEADERS.map(h=>esc(r[h])).join(',')); } return lines.join('\n'); };

  // Local timestamp
  function formatLocalTimestamp(tz){ try{ const d=new Date(); const zone=tz||Intl.DateTimeFormat().resolvedOptions().timeZone; const parts=new Intl.DateTimeFormat('en-US',{timeZone:zone,year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:false,timeZoneName:'short'}).formatToParts(d); const get=t=>parts.find(p=>p.type===t)?.value||''; const yyyy=get('year'),mm=get('month'),dd=get('day'),hh=get('hour'),mi=get('minute'),ss=get('second'); const tzName=get('timeZoneName'); return `${yyyy}-${mm}-${dd} ${hh}:${mi}:${ss} ${tzName}`; }catch(e){ return new Date().toString(); } }

  function readJSON(id){ try{ const el=document.getElementById(id); if(!el) return null; return JSON.parse(el.textContent||''); }catch(e){ return null; } }
  function loadLocalMap(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)||'{}'); }catch(e){ return {}; } }
  function saveLocalMap(map){ localStorage.setItem(STORAGE_KEY, JSON.stringify(map)); }
  function clearLocalMap(){ localStorage.removeItem(STORAGE_KEY); alert('HSMI: local mapping cleared.'); }

  function getMappedEl(entry){ if(!entry) return null; if(entry.type==='id') return document.getElementById(entry.value)||null; if(entry.type==='selector') return document.querySelector(entry.value)||null; if(entry.type==='xpath'){ try{ const r=document.evaluate(entry.value, document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null); return r.singleNodeValue; }catch(e){ return null; } } return null; }
  function buildRef(el){ if(!el) return null; if(el.id) return {type:'id',value:el.id}; const cls=(el.className||'').split(/\s+/).filter(Boolean).slice(0,2).join('.'); if(cls){ const sel=`${el.tagName.toLowerCase()}.${cls}`; try{ const found=document.querySelector(sel); if(found===el) return {type:'selector',value:sel}; }catch(e){} } const parts=[]; let n=el; while(n && n.nodeType===1 && n!==document.documentElement){ const tag=n.nodeName.toLowerCase(); const sibs=[...n.parentNode?.children||[]].filter(x=>x.nodeName===n.nodeName); const idx=sibs.indexOf(n)+1; parts.unshift(`${tag}[${idx}]`); if(tag==='table') break; n=n.parentNode; } return {type:'xpath', value:'/'+parts.join('/')}; }

  const getMobilityAge=()=>{ const v=numFrom(document.querySelector('#final')); return v!==''? v:''; };

  const LABEL_MAP=[
    {key:'vo2_mlkgmin', re:/vo\s*2|v[\.\u0307]?o\s*2|oxygen|ml\s*\/\s*kg\s*\/\s*min/i},
    {key:'sitreach_in', re:/sit\s*&?\s*reach|sit.?and.?reach|reach\s*\((in|cm)\)/i},
    {key:'mtp_pct',     re:/\bmtp\b|metatars|toe\s*-?\s*press|toe\s*-?\s*flex/i},
    {key:'grip_r_pct',  re:/grip[^a-z0-9]*(right|\br\b)/i},
    {key:'grip_l_pct',  re:/grip[^a-z0-9]*(left|\bl\b)/i},
    {key:'sway_r_pct',  re:/sway[^a-z0-9]*(right|\br\b)/i},
    {key:'sway_l_pct',  re:/sway[^a-z0-9]*(left|\bl\b)/i}
  ];
  function readFromLabels(){ const out={}; const rows=[...document.querySelectorAll('table tr')]; for(const tr of rows){ const cells=[...tr.children]; if(cells.length<2) continue; const label=(cells[0].textContent||'').trim(); for(const m of LABEL_MAP){ if(m.re.test(label)){ const rest=cells.slice(1).map(td=>td.textContent||'').join(' '); const val=numFirst(rest); if(val!=='') out[m.key]=val; } } } return out; }

  function getValFromMap(key, asText=false){ const prefer = EMBEDDED_MAP[key] || loadLocalMap()[key] || null; const el = getMappedEl(prefer); if(!el) return ''; return asText ? text(el) : numFrom(el); }

  function collect(){
    const tugJ=readJSON('tug_json');
    const vo2J=readJSON('vo2_json');
    const srJ =readJSON('sr_json');
    const labels = readFromLabels();

    const rec={
      timestamp_local: formatLocalTimestamp(CONFIG.timeZone),
      app_version: document.body.getAttribute('data-app-version')||'',
      name_full: text($(CONFIG.selectors.name)),
      tester: getValFromMap('tester', true) || text($(CONFIG.selectors.tester)) || '',
      location: getValFromMap('location', true) || text($(CONFIG.selectors.location)) || '',
      sex: getValFromMap('sex', true) || text($(CONFIG.selectors.sex)) || '',
      age: getValFromMap('age') || numFrom($(CONFIG.selectors.age)) || '',
      tug_s: numFrom($(CONFIG.selectors.tug_s)) || (tugJ && (tugJ.value||tugJ.tug)) || '',
      vo2_mlkgmin: getValFromMap('vo2_mlkgmin') || (vo2J && (vo2J.value||vo2J.vo2)) || labels.vo2_mlkgmin || '',
      sitreach_in: getValFromMap('sitreach_in') || (srJ && (srJ.value||srJ.sit_reach)) || labels.sitreach_in || '',
      mtp_pct: getValFromMap('mtp_pct') || labels.mtp_pct || '',
      grip_r_pct: getValFromMap('grip_r_pct') || labels.grip_r_pct || '',
      grip_l_pct: getValFromMap('grip_l_pct') || labels.grip_l_pct || '',
      sway_r_pct: getValFromMap('sway_r_pct') || labels.sway_r_pct || '',
      sway_l_pct: getValFromMap('sway_l_pct') || labels.sway_l_pct || '',
      mobility_age: getMobilityAge()
    };

    for(const k of Object.keys(rec)) if(typeof rec[k]==='number' && Number.isNaN(rec[k])) rec[k]='';
    return rec;
  }

  function startMap(){
    const steps=[
      ['age','Click the **Age** NUMBER'],
      ['sex','Click the **Sex/Gender** TEXT'],
      ['tester','Click the **Tester** TEXT'],
      ['location','Click the **Location** TEXT'],
      ['vo2_mlkgmin','Click the **VO‚ÇÇ (ml/kg/min)** NUMBER'],
      ['mtp_pct','Click the **MTP (%)** NUMBER'],
      ['grip_r_pct','Click the **Grip Right (%)** NUMBER'],
      ['grip_l_pct','Click the **Grip Left (%)** NUMBER'],
      ['sway_r_pct','Click the **Sway Right** NUMBER'],
      ['sway_l_pct','Click the **Sway Left** NUMBER'],
      ['sitreach_in','Click the **Sit & Reach** NUMBER']
    ];
    let i=0; let overlay, tip, hl;
    function showTip(msg){ if(!overlay){ overlay=document.createElement('div'); overlay.style.cssText='position:fixed;inset:0;z-index:99997;background:rgba(0,0,0,0.06);pointer-events:none'; document.body.appendChild(overlay); tip=document.createElement('div'); tip.style.cssText='position:fixed;z-index:99998;left:50%;top:20px;transform:translateX(-50%);background:#111;color:#fff;padding:10px 14px;border-radius:10px;font:14px system-ui;box-shadow:0 6px 14px rgba(0,0,0,.2)'; document.body.appendChild(tip); document.addEventListener('click', onClick, true); document.addEventListener('keydown', onKey, true);} tip.innerHTML='HSMI map: '+msg+' <span style="opacity:.75">(Esc to cancel)</span>'; }
    function highlight(el){ if(hl) hl.remove(); if(!el) return; const r=el.getBoundingClientRect(); hl=document.createElement('div'); hl.style.cssText=`position:fixed;z-index:99999;border:2px solid #0a84ff;border-radius:6px;pointer-events:none;left:${r.left-4}px;top:${r.top-4}px;width:${r.width+8}px;height:${r.height+8}px`; document.body.appendChild(hl); }
    function onClick(e){ const el=document.elementFromPoint(e.clientX,e.clientY); if(!el) return; e.preventDefault(); e.stopPropagation(); const key=steps[i][0]; const ref=buildRef(el); if(!ref){ alert('Could not identify that element. Click the digits/text.'); return; } const map=loadLocalMap(); map[key]=ref; saveLocalMap(map); highlight(el); i++; if(i<steps.length){ showTip(steps[i][1]); } else { cleanup(); alert('HSMI: mapping saved. Use **Copy mapping JSON** to embed.'); } }
    function onKey(e){ if(e.key==='Escape'){ cleanup(); alert('HSMI: mapping cancelled.'); } }
    function cleanup(){ if(hl) hl.remove(); if(tip) tip.remove(); if(overlay) overlay.remove(); document.removeEventListener('click', onClick, true); document.removeEventListener('keydown', onKey, true); }
    showTip(steps[i][1]);
  }

  function onProbe(){ const rec=collect(); alert('Capture preview:\n\n'+JSON.stringify(rec,null,2)); }
  function onExportCSV(){ const rec=collect(); const f=buildFilename(rec)+'.csv'; const csv=toCSV([rec]); downloadBlob(csv,'text/csv;charset=utf-8',f); }
  function onExportJSON(){ const rec=collect(); const f=buildFilename(rec)+'.json'; downloadBlob(JSON.stringify(rec,null,2),'application/json',f); }
  function onAudit(){ const rec=collect(); const lines=HEADERS.map(h=>`${h}: ${rec[h] === '' ? '(blank)' : rec[h]}`); const usingEmbedded = Object.keys(EMBEDDED_MAP).length>0; lines.push('\nMapping source: '+(usingEmbedded?'EMBEDDED (all devices)':'localStorage (this device only)')); alert('HSMI audit (v5.2.1)\n\n'+lines.join('\n')); }
  function onAuditMap(){ const local=loadLocalMap(); const use=Object.assign({}, EMBEDDED_MAP, local); const lines=['HSMI mapping refs:']; for(const k of MAP_KEYS_ORDER){ const m=use[k]; const el=getMappedEl(m); const val=el? text(el) : '(no element)'; lines.push(`${k}: ${m? m.type+'‚Üí'+m.value : '(none)'}  | text: ${val || '(empty)'}`); } alert(lines.join('\n')); }
  function onCopyMap(){ const local=loadLocalMap(); const json=JSON.stringify(local, null, 2); try{ navigator.clipboard.writeText(json).then(()=>alert('HSMI: mapping copied. Paste into the hsmi_embedded_map <script> block, then commit.')); }catch(e){ prompt('Copy this JSON and paste into hsmi_embedded_map:', json); } }

  function hideMappingButtonsIfEmbedded(){ if(Object.keys(EMBEDDED_MAP).length>0){ ['btnMap','btnClearMap','btnAuditMap','btnCopyMap'].forEach(id=>{ const b=document.getElementById(id); if(b) b.style.display='none'; }); } }

  // Wire safely
  function wire(){ try{
    document.getElementById('btnExportCSV')?.addEventListener('click', onExportCSV);
    document.getElementById('btnExportJSON')?.addEventListener('click', onExportJSON);
    document.getElementById('btnProbe')?.addEventListener('click', onProbe);
    document.getElementById('btnAudit')?.addEventListener('click', onAudit);
    document.getElementById('btnAuditMap')?.addEventListener('click', onAuditMap);
    document.getElementById('btnCopyMap')?.addEventListener('click', onCopyMap);
    document.getElementById('btnMap')?.addEventListener('click', startMap);
    document.getElementById('btnClearMap')?.addEventListener('click', clearLocalMap);

    hideMappingButtonsIfEmbedded();

    // --- FORCE LOCAL DATE for <input id="testDate" type="date"> ---
    const zone = CONFIG.timeZone || Intl.DateTimeFormat().resolvedOptions().timeZone;
    function setLocalDateNow(){ const el = document.getElementById('testDate'); if (el) el.value = new Date().toLocaleDateString('en-CA', { timeZone: zone }); }
    setLocalDateNow();
    setTimeout(setLocalDateNow, 0);
    document.addEventListener('visibilitychange', ()=>{ if(!document.hidden) setLocalDateNow(); });
    // --------------------------------------------------------------

    window.__HSMI_EXPORT_WIRED__ = true;
    log('wired');
  }catch(e){ err('wire failed:', e); }
  }

  if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', wire, {once:true}); else wire();

  // Expose a tiny debug hook
  window.hsmiExport = { rewire: wire, collect };
})();
</script>

<style>
  .export-controls .btn{ padding:.75rem 1rem;border-radius:.75rem;border:1px solid #ddd;background:#fafafa;cursor:pointer;font-size:.95rem;color:#111 }
  .export-controls .btn:hover{ filter:brightness(.98) }
</style>
<script>
/* === CSV Batcher (localStorage) === */
(function () {
  const KEY = 'mobility_csv_batch_v1';

  function parseCSVLine(line) {
    const out = []; let cur = '', inQuotes = false;
    for (let i = 0; i < line.length; i++) {
      const c = line[i], n = line[i+1];
      if (c === '"' && inQuotes && n === '"') { cur += '"'; i++; continue; }
      if (c === '"') { inQuotes = !inQuotes; continue; }
      if (c === ',' && !inQuotes) { out.push(cur); cur = ''; continue; }
      cur += c;
    }
    out.push(cur);
    return out;
  }

  function getState() {
    try { return JSON.parse(localStorage.getItem(KEY)) || { header: null, rows: [] }; }
    catch { return { header: null, rows: [] }; }
  }
  function setState(s) { localStorage.setItem(KEY, JSON.stringify(s)); }

  function normalizeCSVString(s) {
    return s.replace(/\r\n/g, '\n').replace(/\r/g, '\n').trim();
  }

  function addFromSingleCSV(csvString) {
  const s = getState();
  const norm = normalizeCSVString(csvString);
  const lines = norm.split('\n').filter(Boolean);
  if (lines.length < 2) return;

  const incomingHeader = parseCSVLine(lines[0]);
  let incomingRows = lines.slice(1).map(parseCSVLine);

  // Canonical header comes from global HEADERS
  const CANON = (typeof HEADERS !== 'undefined' && Array.isArray(HEADERS)) ? HEADERS.slice() : incomingHeader.slice();

  // Helper to map a row array from one header to another (fill blanks where missing)
  const mapTo = (row, fromHdr, toHdr) => {
    const idx = Object.fromEntries(fromHdr.map((k, i) => [k, i]));
    return toHdr.map(k => row[idx[k]] ?? '');
  };

  // First import: set header to canonical and map incoming rows
  if (!s.header) {
    s.header = CANON.slice();
    incomingRows = incomingRows.map(r => mapTo(r, incomingHeader, CANON));
    s.rows.push(...incomingRows);
    setState(s);
    return s.rows.length;
  }

  // Remap all saved rows to canonical if needed
  if (s.header.length !== CANON.length || s.header.some((k,i) => k !== CANON[i])) {
    s.rows = s.rows.map(r => mapTo(r, s.header, CANON));
  }

  // Map incoming rows to canonical
  incomingRows = incomingRows.map(r => mapTo(r, incomingHeader, CANON));

  // Commit
  s.header = CANON.slice();
  s.rows.push(...incomingRows);
  setState(s);
  return s.rows.length;
}

  function exportBatch(filename) {
    const s = getState();
    if (!s.header || s.rows.length === 0) { alert('No batched rows to export yet.'); return; }
    const escape = v => {
      if (v == null) return '';
      const str = String(v);
      return /[",\n]/.test(str) ? `"${str.replace(/"/g, '""')}"` : str;
    };
    const csv = [s.header.map(escape).join(',')]
      .concat(s.rows.map(r => r.map(escape).join(',')))
      .join('\n');

    // Suppress our own capture while we create the CSV Blob
    window.__BATCHCSV_SUPPRESS = true;
    try {
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      const ts = new Date().toISOString().replace(/[:T]/g, '-').slice(0,19);
      a.href = url;
      a.download = filename || `mobility_batch_${ts}.csv`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    } finally {
      window.__BATCHCSV_SUPPRESS = false;
    }
  }

  function clearBatch(confirmFirst = true) {
    if (!confirmFirst || confirm('Clear the batched rows? This cannot be undone.')) {
      setState({ header: null, rows: [] });
      if (window.updateBatchBadge) {
        try { window.updateBatchBadge(); } catch (e) {}
      }
    }
  }

  function sizeInfo() {
    const s = getState();
    const approx = JSON.stringify(s).length;
    return { rows: s.rows.length, bytesApprox: approx };
  }

  window.BatchCSV = { addFromSingleCSV, export: exportBatch, clear: clearBatch, sizeInfo };
})();

// Global helper to refresh the floating "CSV Batch" badge, if present
window.updateBatchBadge = function() {
  try {
    if (!window.BatchCSV || typeof window.BatchCSV.sizeInfo !== 'function') return;
    const info = window.BatchCSV.sizeInfo();
    const badge = document.getElementById('batchcsv-count');
    if (badge) {
      const n = info && typeof info.rows === 'number' ? info.rows : 0;
      badge.textContent = `CSV Batch ¬∑ ${n} row${n === 1 ? '' : '(s)'}`;
    }
  } catch (e) {}
};


/* === Auto-capture whatever your app already downloads as CSV ===
   Works for both Blob+URL (type text/csv or vnd.ms-excel) and data: URLs.
   No need to find the csv variable or edit your existing download code.
*/
(function () {
  // 1) Intercept object URLs for CSV blobs
  const realCreate = URL.createObjectURL;
  URL.createObjectURL = function(obj) {
    try {
      const isCSV = obj && obj.type && /(text\/csv|application\/vnd\.ms-excel)/i.test(obj.type);
      if (!window.__BATCHCSV_SUPPRESS && isCSV) {
        const reader = new FileReader();
        reader.onload = () => {
        try {
          BatchCSV.addFromSingleCSV(reader.result);
          if (window.updateBatchBadge) {
            try { window.updateBatchBadge(); } catch (_) {}
          }
        } catch(e){}
      };
        reader.readAsText(obj);
      }
    } catch(e) {}
    return realCreate.call(URL, obj);
  };

  // 2) Intercept clicks on anchors that download CSV via data: URL
  document.addEventListener('click', function(e){
    const a = e.target && e.target.closest && e.target.closest('a[download]');
    if (!a) return;
    if (window.__BATCHCSV_SUPPRESS) return;
    const href = a.getAttribute('href') || '';
    if (/^data:(text\/csv|application\/vnd\.ms-excel)/i.test(href)) {
      try {
        // Support both plain and URL-encoded payloads
        const comma = href.indexOf(',');
        if (comma > -1) {
          const payload = href.slice(comma + 1);
          const csv = href.slice(0, comma).includes(';base64')
            ? atob(payload)
            : decodeURIComponent(payload);
          BatchCSV.addFromSingleCSV(csv);
          if (window.updateBatchBadge) {
            try { window.updateBatchBadge(); } catch (_) {}
          }
        }
      } catch(e){}
    }
  }, true);
})();
</script>

<script>
// Safety: try again shortly in case BatchCSV loads after this script
setTimeout(() => {
  try { if (typeof ensurePanel === 'function') ensurePanel(); } catch(_) {}
  if (typeof patchBatchCSV === 'function') patchBatchCSV();
}, 150);
</script>

<script>
/* Filename = mobility_batch_YYYY-MM-DD_<location>_<label>.csv
   - Prompts for Location (remembered via localStorage) and optional Label
   - Uses your local date
   - Safely sanitizes for filenames
*/
(function () {
  const LS_LOCATION_KEY = 'mobility_csv_default_location';
  const LS_LABEL_KEY    = 'mobility_csv_default_label'; // remembered too (optional)

  function localDateYYYYMMDD() {
    const d = new Date(); // user's local time
    const y = d.getFullYear();
    const m = String(d.getMonth() + 1).padStart(2, '0');
    const day = String(d.getDate()).padStart(2, '0');
    return `${y}-${m}-${day}`;
  }
  function sanitizePart(s) {
    return (s || '')
      .trim()
      .replace(/[/\\?%*:|"<>]/g, '-') // Windows/Unix-unsafe
      .replace(/\s+/g, '_')           // spaces -> underscores
      .replace(/_+/g, '_')            // collapse repeats
      .replace(/^_+|_+$/g, '')        // trim leading/trailing _
      .slice(0, 60);                  // keep tidy
  }

  function patch() {
    if (!window.BatchCSV || BatchCSV.__namePatched) return;
    const export0 = BatchCSV.export;

    BatchCSV.export = function () {
      const defaultLoc = localStorage.getItem(LS_LOCATION_KEY) || '';
      const defaultLbl = localStorage.getItem(LS_LABEL_KEY) || '';

      const rawLoc = prompt('Location for filename (e.g., Studio_A, Home_Visit, Houston):', defaultLoc);
      const rawLbl = prompt('Optional label (e.g., client or note):', defaultLbl);

      const loc = sanitizePart(rawLoc);
      const lbl = sanitizePart(rawLbl);

      // Remember for next time
      localStorage.setItem(LS_LOCATION_KEY, loc);
      localStorage.setItem(LS_LABEL_KEY, lbl);

      const date = localDateYYYYMMDD();
      const name =
        `mobility_batch_${date}`
        + (loc ? `_${loc}` : '')
        + (lbl ? `_${lbl}` : '')
        + `.csv`;

      return export0(name);
    };
    BatchCSV.__namePatched = true;
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', patch);
  } else {
    patch();
  }
  setTimeout(patch, 150); // safety in case BatchCSV initializes a tick later
})();
</script>
<script>
/* ======================= iPad/iPhone‚Äìfirst CSV Export SHIM ======================= */

/* Detect Apple touch (iPad can report "Mac" in UA) */
const isIOSFamily = (() => {
  const ua = navigator.userAgent || '';
  return /iPad|iPhone|iPod/.test(ua) || (ua.includes('Mac') && 'ontouchend' in document);
})();

/* Unified export (Share sheet on iOS; download elsewhere) */
async function exportCSV_iosFirst(filename, csvString) {
  const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8' });

  if (isIOSFamily && navigator.canShare) {
    try {
      const file = new File([blob], filename, { type: 'text/csv' });
      if (navigator.canShare({ files: [file] })) {
        await navigator.share({ files: [file], title: filename, text: 'Mobility export' });
        return;
      }
    } catch (e) { /* fall through */ }
  }

  if (isIOSFamily) {
    const url = URL.createObjectURL(blob);
    window.open(url, '_blank');
    setTimeout(() => URL.revokeObjectURL(url), 15000);
    return;
  }

  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  a.remove();
  setTimeout(() => URL.revokeObjectURL(url), 15000);
}

/* -------- Helpers to find your CSV strings regardless of naming -------- */

function tryFuncs(funcNames) {
  for (const name of funcNames) {
    const fn = name.split('.').reduce((o,k)=>o && o[k], window);
    if (typeof fn === 'function') {
      try { const val = fn(); if (val) return val; } catch {}
    }
  }
  return '';
}

function tryVars(varNames) {
  for (const path of varNames) {
    const val = path.split('.').reduce((o,k)=>o && o[k], window);
    if (typeof val === 'string' && val.trim()) return val;
  }
  return '';
}

function getSingleCsvString() {
  // Common variable/function candidates we‚Äôve seen in your builds
  const varCandidates = [
    'app.csvString', 'app.csv_string', 'app.currentCsv', 'app.singleCsv',
    'csvString', 'currentCsv', 'singleCsv'
  ];
  const fnCandidates = [
    'app.buildCurrentCsv', 'app.buildCsv', 'buildCurrentCsv', 'buildCsv', 'buildCsvSomehow'
  ];
  return tryVars(varCandidates) || tryFuncs(fnCandidates);
}

function getBatchCsvString() {
  const varCandidates = [
    'app.batchCsvString', 'app.csvStringBatch', 'app.batch_csv', 'app.batchCsv',
    'batchCsvString', 'csvStringBatch', 'batchCsv'
  ];
  const fnCandidates = [
    'app.buildBatchCsv', 'buildBatchCsv'
  ];
  return tryVars(varCandidates) || tryFuncs(fnCandidates);
}

/* -------- Filename builder that adapts to your state -------- */

function localISODate() {
  const d = new Date();
  return [d.getFullYear(), String(d.getMonth()+1).padStart(2,'0'), String(d.getDate()).padStart(2,'0')].join('-');
}
function slug(s) { return String(s||'').trim().replace(/\s+/g,'_').replace(/[^A-Za-z0-9_\-]/g,''); }

function getField(...candidates) {
  for (const path of candidates) {
    const v = path.split('.').reduce((o,k)=>o && o[k], window);
    if (typeof v === 'string' && v) return v;
  }
  return '';
}

function buildSingleFilename() {
  const date = getField('app.localDate') || localISODate();
  const last = slug(getField('app.lastName','app.lname','lastName','lname'));
  const first = slug(getField('app.firstName','app.fname','firstName','fname'));
  const loc = slug(getField('app.locationLabel','app.location','locationLabel','location') || 'loc');
  const explicit = getField('app.csvFilename','csvFilename');
  return explicit || `mobility_${date}_${last}_${first}_${loc}.csv`;
}

function buildBatchFilename() {
  const date = getField('app.localDate') || localISODate();
  const label = slug(getField('app.batchLabel','app.label','batchLabel','label') || 'batch');
  const loc = slug(getField('app.locationLabel','app.location','locationLabel','location') || 'loc');
  const explicit = getField('app.batchCsvFilename','batchCsvFilename');
  return explicit || `mobility_batch_${date}_${label}_${loc}.csv`;
}

/* -------- Find your buttons by ID or by visible text -------- */

function findButtonByIdOrText(id, textIncludes) {
  let el = id ? document.getElementById(id) : null;
  if (el) return el;
  const candidates = Array.from(document.querySelectorAll('button, a, [role="button"]'));
  const needle = (textIncludes || '').toLowerCase();
  return candidates.find(btn => (btn.textContent || btn.innerText || '').toLowerCase().includes(needle)) || null;
}

// -------- Wire everything up --------

function wireCsvExports() {
  if (!isIOSFamily) return; // iPad/iPhone only

  // SINGLE
  const singleBtn = findButtonByIdOrText('downloadCsvBtn', 'download csv');
  if (singleBtn) {
    singleBtn.addEventListener('click', async () => {
      await new Promise(r => setTimeout(r, 0));
      let csv = getSingleCsvString();
      if (!csv) { await new Promise(r => setTimeout(r, 50)); csv = getSingleCsvString(); }
      if (!csv) return;
      const name = buildSingleFilename();
      await exportCSV_iosFirst(name, csv);
    });
  }

  // BATCH
  const batchBtn = findButtonByIdOrText('downloadBatchCsvBtn', 'batch');
  if (batchBtn) {
    batchBtn.addEventListener('click', async () => {
      await new Promise(r => setTimeout(r, 0));
      let csv = getBatchCsvString();
      if (!csv) { await new Promise(r => setTimeout(r, 50)); csv = getBatchCsvString(); }
      if (!csv) return;
      const name = buildBatchFilename();
      await exportCSV_iosFirst(name, csv);
    });
  }
}
  if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', wireCsvExports);
} else {
  wireCsvExports();
  } // close the JS block

</script>  <!-- ‚Üê close the <script> tag BEFORE injecting HTML/CSS -->
<!-- ===== MOBILITY APP: MEMBER FIRST/LAST PATCH v3 (targeted insert) ===== -->
<style>
  .name-row { display:grid; grid-template-columns:1fr 1fr; gap:0.75rem; margin:0.5rem 0 1rem; }
  .name-row label { display:block; font-weight:600; margin-bottom:0.25rem; }
  .offscreen { position:absolute; left:-9999px; width:1px; height:1px; opacity:0; }
</style>

<script>
(function(){
  function ready(fn){
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', fn);
    } else {
      // Run after the current JS finishes building the UI
      setTimeout(fn, 0);
    }
  }

  ready(function(){
    // ---- CONFIG: if you know your controls container, set it here for precision ----
    var explicitControls = document.querySelector('#controls') 
                        || document.querySelector('.controls') 
                        || document.querySelector('#left-col') 
                        || document.querySelector('#app');

    function $(sel, root){ return (root||document).querySelector(sel); }
    function make(el, html){ var d=document.createElement(el); if(html) d.innerHTML=html; return d; }

    // Find existing memberName label/input to anchor insertion (AFTER UI is built)
    var memberInput = $('#memberName');
    var memberLabel = $('label[for="memberName"]');

    // Fallback controls container
    var controls = (memberLabel && memberLabel.parentElement) || (memberInput && memberInput.parentElement)
                || explicitControls || $('form') || document.body;

    // Build First/Last UI
    var wrapper = make('div');
    wrapper.className = 'name-row';
    wrapper.innerHTML = `
      <div>
        <label for="firstName">First Name</label>
        <input type="text" id="firstName" name="firstName" autocomplete="given-name">
      </div>
      <div>
        <label for="lastName">Last Name</label>
        <input type="text" id="lastName" name="lastName" autocomplete="family-name">
      </div>
    `;

    // Insert near old Member Name; else at top of controls
    if (memberLabel && memberLabel.parentElement) {
      memberLabel.parentElement.insertAdjacentElement('afterend', wrapper);
    } else if (memberInput && memberInput.parentElement) {
      memberInput.parentElement.insertAdjacentElement('afterend', wrapper);
    } else if (controls && controls.firstChild) {
      controls.insertBefore(wrapper, controls.firstChild);
    } else {
      (controls || document.body).appendChild(wrapper);
    }

    // Keep legacy #memberName (hidden) so existing code continues to work
    if (!memberInput) {
      memberInput = make('input');
      memberInput.type = 'text';
      memberInput.id = 'memberName';
      memberInput.name = 'memberName';
      memberInput.className = 'offscreen';
      (controls || document.body).appendChild(memberInput);
    } else {
      memberInput.classList.add('offscreen');
      if (memberLabel) memberLabel.style.display = 'none';
    }

    var firstEl = $('#firstName', wrapper);
    var lastEl  = $('#lastName',  wrapper);

    // Sync as "Last, First" (change to `${f} ${l}` if you prefer)
    function syncHidden(){
      var f = (firstEl.value || '').trim();
      var l = (lastEl.value  || '').trim();
      memberInput.value = (f && l) ? (l + ', ' + f) : (f || l);
      try { memberInput.dispatchEvent(new Event('input', {bubbles:true})); }
      catch(e){ var evt=document.createEvent('Event'); evt.initEvent('input', true, true); memberInput.dispatchEvent(evt); }
    }
    firstEl.addEventListener('input', syncHidden);
    lastEl .addEventListener('input', syncHidden);

    // Prefill from existing memberName ("Last, First" or "First Last")
    (function prefill(){
      var v = (memberInput.value || '').trim(); if (!v) return;
      var f='', l='';
      if (v.includes(',')) { var p=v.split(','); l=(p[0]||'').trim(); f=(p.slice(1).join(',')||'').trim(); }
      else { var p=v.split(/\s+/); if (p.length===1) f=p[0]; else { f=p.slice(0,-1).join(' '); l=p.slice(-1)[0]; } }
      if (!firstEl.value && f) firstEl.value=f;
      if (!lastEl.value  && l) lastEl.value =l;
      syncHidden();
    })();

    // Handle form reset
    var form = controls && controls.closest ? controls.closest('form') : null;
    if (form) {
      form.addEventListener('reset', function(){
        setTimeout(function(){ firstEl.value=''; lastEl.value=''; syncHidden(); }, 0);
      });
    }
  });
})();
</script>

<!-- ===== End FIRST/LAST PATCH v3 ===== -->

<!-- Print helper (v18-clean, single-instance, no popups) -->
 <!-- Floating Batch CSV panel -->
<script>
(function(){
  function ensurePanel(){
    if (document.getElementById('batchcsv-panel')) return;

    const panel = document.createElement('div');
    panel.id = 'batchcsv-panel';
    Object.assign(panel.style, {
      position:'fixed', right:'16px', bottom:'16px',
      padding:'10px 12px', background:'rgba(255,255,255,0.96)',
      border:'1px solid #ddd', borderRadius:'12px',
      boxShadow:'0 4px 16px rgba(0,0,0,0.15)', zIndex:'9999',
      fontFamily:'system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif',
      fontSize:'14px'
    });
    panel.innerHTML = `
      <div id="batchcsv-count" style="margin-bottom:6px;">CSV Batch ¬∑ 0 row(s)</div>
      <div style="display:flex; gap:10px;">
        <button id="btn-batch-export" style="padding:.6rem 1rem; border:0; border-radius:999px; background:#2563eb; color:#fff; font-weight:700;">Export Batch CSV</button>
        <button id="btn-batch-clear"  style="padding:.6rem 1rem; border:0; border-radius:999px; background:#2563eb; color:#fff; font-weight:700;">Clear Batch</button>
      </div>
    `;
    document.body.appendChild(panel);

    const safe = fn => typeof fn === 'function';
    const X = document.getElementById('btn-batch-export');
    const C = document.getElementById('btn-batch-clear');
    if (X) X.onclick = ()=> { if (window.BatchCSV && safe(window.BatchCSV.export)) window.BatchCSV.export(); };
    if (C) C.onclick = ()=> { if (window.BatchCSV && safe(window.BatchCSV.clear))  window.BatchCSV.clear();  };

    try {
      const info = window.BatchCSV && window.BatchCSV.sizeInfo && window.BatchCSV.sizeInfo();
      const badge = document.getElementById('batchcsv-count');
      if (info && badge) badge.textContent = `CSV Batch ¬∑ ${info.rows} row(s)`;
    } catch(e){}
  }

  // Build once after DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', ensurePanel);
  } else {
    ensurePanel();
  }
})();
</script>

<style>
  #print-reliable-btn{
    position:fixed; bottom:18px; left:18px; z-index:2147483647 !important;
    padding:.9rem 1.25rem; border-radius:999px; border:0;
    background:#2563eb; color:#fff; font-weight:900; font-size:15px;
    box-shadow:0 10px 24px rgba(0,0,0,.22);
  }
  #v18-banner{
    position:fixed; right:12px; top:12px; z-index:2147483646 !important;
    background:#111; color:#fff; padding:6px 10px; border-radius:8px; font-size:12px; opacity:.9;
  }
  @media print { #print-reliable-btn, #v18-banner { display:none !important } }
</style>
<!-- Floating Batch CSV panel (clean, single instance) -->
<script>
(function(){
  function updateBadge(){
    try{
      const el = document.getElementById('batchcsv-count');
      const info = window.BatchCSV && window.BatchCSV.sizeInfo && window.BatchCSV.sizeInfo();
      if (el) el.textContent = `CSV Batch ¬∑ ${(info && info.rows) || 0} row(s)`;
    }catch(_){}
  }

  function ensurePanel(){
    if (document.getElementById('batchcsv-panel')) return;

    const panel = document.createElement('div');
    panel.id = 'batchcsv-panel';
    Object.assign(panel.style, {
      position:'fixed', right:'16px', bottom:'16px',
      padding:'10px 12px', background:'rgba(255,255,255,0.96)',
      border:'1px solid #ddd', borderRadius:'12px',
      boxShadow:'0 4px 16px rgba(0,0,0,0.15)', zIndex:'9999',
      fontFamily:'system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif',
      fontSize:'14px'
    });

    panel.innerHTML = `
      <div id="batchcsv-count" style="margin-bottom:6px;">CSV Batch ¬∑ 0 row(s)</div>
      <div style="display:flex; gap:10px;">
        <button id="btn-batch-export" style="padding:.6rem 1rem; border:0; border-radius:999px; background:#2563eb; color:#fff; font-weight:700;">Export Batch CSV</button>
        <button id="btn-batch-clear"  style="padding:.6rem 1rem; border:0; border-radius:999px; background:#2563eb; color:#fff; font-weight:700;">Clear Batch</button>
      </div>
    `;
    document.body.appendChild(panel);

    const safe = fn => typeof fn === 'function';
    const X = document.getElementById('btn-batch-export');
    const C = document.getElementById('btn-batch-clear');
    if (X) X.onclick = ()=> { if (window.BatchCSV && safe(window.BatchCSV.export)) window.BatchCSV.export(); updateBadge(); };
    if (C) C.onclick = ()=> { if (window.BatchCSV && safe(window.BatchCSV.clear))  window.BatchCSV.clear();  updateBadge(); };

    updateBadge();
  }

  // Build once after DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', ensurePanel);
  } else {
    ensurePanel();
  }

  // optional: expose for late updates
  window.ensureBatchPanel = ensurePanel;
  window.updateBatchBadge = updateBadge;
})();
</script>

<!-- ===== FINAL TAIL (batch panel + print helper) ‚Äî paste once ===== -->

<!-- Floating Batch CSV panel (bottom-right) -->
<script>
(function(){
  function ensureBatchPanel(){
    if (document.getElementById('batchcsv-panel')) return;

    var panel = document.createElement('div');
    panel.id = 'batchcsv-panel';
    panel.style.position='fixed';
    panel.style.right='16px';
    panel.style.bottom='16px';
    panel.style.padding='10px 12px';
    panel.style.background='rgba(255,255,255,0.96)';
    panel.style.border='1px solid #ddd';
    panel.style.borderRadius='12px';
    panel.style.boxShadow='0 4px 16px rgba(0,0,0,0.15)';
    panel.style.zIndex='9999';
    panel.style.fontFamily='system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif';
    panel.style.fontSize='14px';

    panel.innerHTML =
      '<div id="batchcsv-count" style="margin-bottom:6px;">CSV Batch ¬∑ 0 row(s)</div>' +
      '<div style="display:flex; gap:10px;">' +
      '  <button id="btn-batch-export" style="padding:.6rem 1rem; border:0; border-radius:999px; background:#2563eb; color:#fff; font-weight:700;">Export Batch CSV</button>' +
      '  <button id="btn-batch-clear"  style="padding:.6rem 1rem; border:0; border-radius:999px; background:#2563eb; color:#fff; font-weight:700;">Clear Batch</button>' +
      '</div>';

    document.body.appendChild(panel);

    function updateBadge(){
      try{
        var info = window.BatchCSV && window.BatchCSV.sizeInfo && window.BatchCSV.sizeInfo();
        var el = document.getElementById('batchcsv-count');
        if (el) el.textContent = 'CSV Batch ¬∑ ' + ((info && info.rows) || 0) + ' row(s)';
      }catch(_){}
    }

    var X = document.getElementById('btn-batch-export');
    var C = document.getElementById('btn-batch-clear');
    if (X) X.onclick = function(e){ e.stopPropagation();
      if (window.BatchCSV && typeof window.BatchCSV.export==='function') window.BatchCSV.export();
      updateBadge();
    };
    if (C) C.onclick = function(e){ e.stopPropagation();
      if (window.BatchCSV && typeof window.BatchCSV.clear==='function') window.BatchCSV.clear();
      updateBadge();
    };

    updateBadge();
  }

  if (document.readyState==='loading'){
    document.addEventListener('DOMContentLoaded', ensureBatchPanel);
  } else {
    ensureBatchPanel();
  }
})();
</script>
<!-- Safe scrubber: remove only VISIBLE code-like text, never script/style -->
<script>
(function(){
  function scrub(){
    var walker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, null, false);
    var doomed=[];
    while(walker.nextNode()){
      var n=walker.currentNode, p=n.parentNode, t=n.data||'';
      // skip real code blocks
      if (p && p.tagName && /^(SCRIPT|STYLE)$/i.test(p.tagName)) continue;
      // target the junk you reported
      if (/function\s+iframePrint\s*\(/.test(t) || /function\s+buildPrintableHTML\s*\(/.test(t)){
        doomed.push(n);
      }
    }
    doomed.forEach(function(n){
      var p=n.parentNode;
      if (p && /^(PRE|CODE)$/i.test(p.tagName)) p.remove(); else n.remove();
    });
  }
  if (document.readyState==='loading') document.addEventListener('DOMContentLoaded', scrub); else scrub();
  setTimeout(scrub, 0);
})();
</script>

<script>
(function(){
  if (window.__PRINT_WIRED__) return; window.__PRINT_WIRED__ = true;

  // ---- Inject UI (CSS + banner + button + iframe), no raw HTML in page ----
  function injectPrintUI(){
    // CSS
    var style = document.createElement('style');
    style.textContent =
      '#print-reliable-btn{position:fixed;bottom:18px;left:18px;z-index:2147483647;padding:.9rem 1.25rem;border-radius:999px;border:0;background:#2563eb;color:#fff;font-weight:900;font-size:15px;box-shadow:0 10px 24px rgba(0,0,0,.22)}' +
      '#v18-banner{position:fixed;right:12px;top:12px;z-index:2147483646;background:#111;color:#fff;padding:6px 10px;border-radius:8px;font-size:12px;opacity:.9}' +
      '@media print{#print-reliable-btn,#v18-banner{display:none!important}}';
    document.head.appendChild(style);

    // Banner
    if (!document.getElementById('v18-banner')){
      var b = document.createElement('div');
      b.id = 'v18-banner';
      b.innerHTML = 'Print helper <strong>v18</strong> ‚Ä¢ press <strong>Alt+P</strong> or click';
      document.body.appendChild(b);
    }
    // Button
    if (!document.getElementById('print-reliable-btn')){
      var btn = document.createElement('button');
      btn.id = 'print-reliable-btn'; btn.type='button';
      btn.title='Prints via hidden iframe'; btn.textContent='Print (reliable)';
      document.body.appendChild(btn);
    }
    // Hidden iframe
    if (!document.getElementById('print-sandbox')){
      var f = document.createElement('iframe');
      f.id='print-sandbox';
      f.style.cssText='position:fixed;left:-9999px;top:-9999px;width:0;height:0;visibility:hidden;';
      f.setAttribute('aria-hidden','true');
      document.body.appendChild(f);
    }
  }

  // ---- Build printable HTML (Inputs summary on page 1; Results on page 2) ----
  function buildPrintableHTML(){
    function esc(s){ return String(s==null?'':s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
    var root = document.querySelector('.wrap') || document.querySelector('main') || document.body;

    // Collect label‚Üívalue pairs from current form
    var pairs = [];
    var labels = root.querySelectorAll('label');
    for (var i=0;i<labels.length;i++){
      var lab = labels[i];
      var id = lab.getAttribute('for');
      var ctrl = id ? document.getElementById(id) : null;
      if (!ctrl && lab.nextElementSibling && /^(INPUT|SELECT|TEXTAREA)$/.test(lab.nextElementSibling.tagName)) ctrl = lab.nextElementSibling;
      if (!ctrl) continue;

      var val = '';
      if (ctrl.tagName==='SELECT'){
        var opt = ctrl.options[ctrl.selectedIndex]; val = opt ? (opt.text || opt.value) : '';
      } else if (ctrl.type==='checkbox' || ctrl.type==='radio'){
        val = ctrl.checked ? (ctrl.value || 'Yes') : 'No';
      } else { val = ctrl.value || ''; }
      val = (''+val).trim(); if (!val) continue;

      var key = (lab.textContent||'').replace(/\s*\(.*?\)\s*$/,'').trim().replace(/:$/,'');
      pairs.push([key, val]);
    }

    // Clone cards/sections
    var host = document.querySelector('.wrap')||document.querySelector('main')||document.body;
    var nodes = Array.prototype.slice.call(host.querySelectorAll('section, fieldset, .card')).map(function(n){ return n.cloneNode(true); });

    // Remove original Inputs section (with empty form fields)
    for (var j=0;j<nodes.length;j++){
      var h2in = nodes[j].querySelector('h2');
      if (h2in && /inputs/i.test((h2in.textContent||''))){ nodes.splice(j,1); break; }
    }

    // Build compact Inputs table
    var intro = document.createElement('section'); intro.className='card inputs-card'; intro.id='report-inputs';
    var html = '<h2>Inputs</h2><table><thead><tr><th>Field</th><th>Value</th></tr></thead><tbody>';
    for (var k=0;k<pairs.length;k++){ html += '<tr><td>'+esc(pairs[k][0])+'</td><td>'+esc(pairs[k][1])+'</td></tr>'; }
    html += '</tbody></table>';
    html += '<p class="inputs-legend">Units: Sit &amp; Reach (inches), TUG (seconds), Mid-Thigh Pull (percentile), Postural Sway (percentile), Grip Strength (percentile), VO‚ÇÇ Max (ml/kg/min).</p>';
    intro.innerHTML = html;

    // Build patient-facing summary card (if age and Mobility Age are available)
    var summaryCard = null;
    try {
      var ageEl  = document.getElementById('age');
      var sexEl  = document.getElementById('sex');
      var finEl  = document.getElementById('final');
      var ageVal = ageEl ? parseFloat(ageEl.value) : NaN;
      var mobVal = finEl ? parseFloat((finEl.textContent || finEl.innerText || '').replace(/[^0-9.\-]/g,'')) : NaN;
      if (isFinite(ageVal) && isFinite(mobVal)) {
        var delta   = mobVal - ageVal;
        var deltaAbs = Math.abs(delta);
        var summaryMessage = '';
        if (delta < -0.25) {
          summaryMessage = 'Your Mobility Age is younger than your actual age. This suggests that your current mobility profile supports healthy aging and independence. Let\'s build on that strength.';
        } else if (delta > 0.25) {
          summaryMessage = 'Your Mobility Age is higher than your actual age. That\'s a signal we can improve your strength, balance and endurance to support healthier, more independent years.';
        } else {
          summaryMessage = 'Your Mobility Age is very close to your actual age. This is a solid starting point, and we can work together to keep you strong, mobile, and independent as you age.';
        }

        // Collect MAE data from the Results table
        var resultsTable = document.querySelector('#results tbody#rows') || document.querySelector('#rows');
        var tests = [];
        if (resultsTable) {
          var trs = resultsTable.querySelectorAll('tr');
          for (var i=0;i<trs.length;i++){
            var tds = trs[i].querySelectorAll('td');
            if (tds.length >= 5) {
              var tName = (tds[0].textContent || '').trim();
              var maeRaw = (tds[4].textContent || '').trim();
              var maeVal = parseFloat(maeRaw.replace(/[^0-9.\-]/g,''));
              if (!isNaN(maeVal)) {
                var d = maeVal - ageVal;
                tests.push({ name: tName, mae: maeVal, delta: d });
              }
            }
          }
        }

        function classifyDelta(d){
          if (!isFinite(d)) return { label: '', cls: 'badge-neutral' };
          if (d <= -5) return { label: 'Younger', cls: 'badge-good' };
          if (d >=  5) return { label: 'Older', cls: 'badge-focus' };
          return { label: 'On track', cls: 'badge-neutral' };
        }

        var testsHtml = '';
        if (tests.length){
          for (var i=0;i<tests.length;i++){
            var t = tests[i];
            var cls = classifyDelta(t.delta);
            var label = cls.label;
            var badgeCls = 'summary-badge ' + cls.cls;
            var maeText = isFinite(t.mae) ? t.mae.toFixed(1) : '';
            testsHtml += '<li>';
            testsHtml +=   '<div class="test-line-main"><span class="test-name">'+esc(t.name)+'</span><span class="test-mae">MAE: '+esc(maeText)+'</span></div>';
            if (label){
              testsHtml += '<div class="test-line-status"><span class="'+badgeCls+'">'+esc(label)+'</span></div>';
            }
            testsHtml += '</li>';
          }
        }

        // Build summary HTML
        var sexText = sexEl && sexEl.value ? sexEl.value : '';
        var deltaText = '';
        if (isFinite(delta)){
          var yrs = deltaAbs.toFixed(1).replace(/\.0$/,'');
          if (yrs && yrs !== '0') {
            if (delta < 0) deltaText = yrs + ' year' + (yrs==='1'?'':'s') + ' younger than your age';
            else if (delta > 0) deltaText = yrs + ' year' + (yrs==='1'?'':'s') + ' older than your age';
          }
        }

        var summaryHtml = '<h2>Your Mobility Age Summary</h2>';
        summaryHtml += '<div class="summary-hero">';
        summaryHtml +=   '<div class="summary-hero-main">';
        summaryHtml +=     '<div class="summary-label">Mobility Age</div>';
        summaryHtml +=     '<div class="summary-value">'+esc(mobVal.toFixed(1).replace(/\.0$/,""))+'</div>';
        summaryHtml +=   '</div>';
        summaryHtml +=   '<div class="summary-hero-side">';
        summaryHtml +=     '<div class="summary-age-line"><span class="summary-label">Chronological age</span>: <span class="summary-age-value">'+esc(ageVal.toFixed(0))+'</span></div>';
        if (deltaText){
          summaryHtml +=   '<div class="summary-delta">'+esc(deltaText)+'</div>';
        }
        if (sexText){
          summaryHtml +=   '<div class="summary-sex">Sex: '+esc(sexText)+'</div>';
        }
        summaryHtml +=   '</div>';
        summaryHtml += '</div>';
        summaryHtml += '<p class="summary-message">'+esc(summaryMessage)+'</p>';

        if (testsHtml){
          summaryHtml += '<div class="summary-tests">';
          summaryHtml +=   '<div class="summary-tests-heading">How your six tests compare</div>';
          summaryHtml +=   '<ul>'+testsHtml+'</ul>';
          summaryHtml +=   '<p class="summary-tests-note">‚ÄúYounger‚Äù means this area is a relative strength compared with people your age and gender. ‚ÄúOlder‚Äù highlights opportunities to improve and protect your future mobility and independence.</p>';
          summaryHtml += '</div>';
        }

        summaryHtml += '<div class="summary-text">';
        summaryHtml +=   '<p>Taken together, your Mobility Age and the six Mobility Age Equivalents (MAEs) give us a snapshot of how your strength, balance, flexibility and endurance are supporting your long-term health and independence.</p>';
        summaryHtml +=   '<p>Your SENS Wellness Coach will use this profile‚Äîalong with your medical history, goals and preferences‚Äîto design a practical, personalized plan to improve or maintain your mobility, fitness and healthspan.</p>';
        summaryHtml +=   '<p>Over the next 3‚Äì6 months, we will focus on the building blocks of healthy aging: aerobic capacity, strength, balance, flexibility, sleep, nutrition and stress management.</p>';
        summaryHtml += '</div>';

        summaryCard = document.createElement('section');
        summaryCard.className = 'card summary-card';
        summaryCard.innerHTML = summaryHtml;
      }
    } catch(e){}

    if (summaryCard) {
      nodes.unshift(intro);
      nodes.unshift(summaryCard);
    } else {
      nodes.unshift(intro); // place on page 1
    }

    // Strip interactive controls in clones
    nodes.forEach(function(el){
      Array.prototype.slice.call(el.querySelectorAll('button,.toolbar,.btn,[role="button"],#csv-batch,.csv-batch,#dbg,#err')).forEach(function(x){ x.remove(); });
    });

    // Compose doc
    var frag = document.createElement('div'); nodes.forEach(function(n){ frag.appendChild(n); });
    // Insert explanatory paragraph between Inputs and Results
    (function(){
      try {
        var resultsSection = null;
        var cards = frag.querySelectorAll('section,fieldset,.card');
        for (var i=0;i<cards.length;i++){
          var h2 = cards[i].querySelector('h2');
          if (h2 && /results/i.test((h2.textContent||''))){
            resultsSection = cards[i];
            break;
          }
        }
        if (resultsSection && resultsSection.parentNode){
          var p = document.createElement('p');
          p.className = 'report-body';
          p.textContent = 'Your six Mobility Age Equivalent (MAE) scores and your overall HSMI are shown below. The three middle columns‚ÄîZ score, Weight, and Weighted Z‚Äîshow how we standardize your results against a large database of people your age and gender, and then apply research-based weights to each test. This is how we derive your six MAEs. Your final Mobility Age is the average of those six weighted MAEs. Your SENS Wellness Coach will walk you through how you performed on each MAE and what your overall Mobility Age means for your healthspan and mobility goals.';
          resultsSection.parentNode.insertBefore(p, resultsSection);
          var legend = document.createElement('p');
          legend.className = 'results-legend';
          legend.textContent = 'Your Z score compares your performance to thousands of people your age and gender. A positive Z score (above 0.0) means you outperformed that group, while a negative score (below 0.0) means you underperformed. Each Z score is multiplied by a weight that reflects its contribution to longevity. The highest weight, 1.5, is assigned to your aerobic capacity (VO‚ÇÇ max), because it has the strongest association with long-term health and survival.';
          resultsSection.appendChild(legend);
        }
      } catch (e) {}
    })();

    var logo = document.querySelector('.brandbar img');
    var logoSrc = logo ? logo.getAttribute('src') : '';
    var logoAlt = logo ? (logo.getAttribute('alt') || 'Healthspan logo') : 'Healthspan logo';

    var css =
      '<style>' +
      'body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;color:#1f2933;background:#ffffff;}' +
      '@page{size:Letter portrait;margin:14mm;}' +
      '*,*::before,*::after{-webkit-print-color-adjust:exact;print-color-adjust:exact;}' +
      '.report-header{display:flex;align-items:center;gap:16px;margin-bottom:10mm;border-bottom:2px solid #004080;padding-bottom:8px;background:#f3f7ff;}' +
      '.report-logo img{height:52px;width:auto;}' +
      '.report-title-block{display:flex;flex-direction:column;gap:2px;}' +
      '.report-company{font-size:11pt;font-weight:600;color:#004080;text-transform:uppercase;letter-spacing:.10em;}' +
      '.report-title{font-size:20pt;font-weight:800;margin:0;color:#004080;}' +
      '.report-title sup{font-size:60%;font-weight:700;vertical-align:super;}' +
      '.report-intro{font-size:9.5pt;line-height:1.3;margin:0 0 8pt 0;color:#374151;}.report-intro-block .report-intro:last-child{margin-bottom:0;}' +
      '.report-intro-block{margin:6px 0 3mm;}' +
      '.report-body{font-size:10.5pt;line-height:1.5;margin:6mm 0 4mm;color:#374151;}' +
      '.inputs-legend{font-size:9pt;margin-top:6px;color:#6b7280;font-style:italic;}' +
      '.results-legend{font-size:9pt;margin-top:6px;color:#6b7280;font-style:italic;}' +
      '.summary-card{border:1px solid #cbd5e1;border-radius:12px;padding:14px 16px;margin:4px 0 10px;background:#f8fafc;}' +
      '.summary-hero{display:flex;flex-wrap:wrap;align-items:baseline;justify-content:space-between;gap:12px;margin-bottom:8px;}' +
      '.summary-hero-main{display:flex;align-items:baseline;gap:8px;}' +
      '.summary-label{font-size:11pt;color:#4b5563;}' +
      '.summary-value{font-size:24pt;font-weight:800;color:#004080;}' +
      '.summary-hero-side{display:flex;flex-direction:column;gap:2px;font-size:10pt;color:#374151;}' +
      '.summary-delta{font-size:10pt;color:#004080;}' +
      '.summary-sex{font-size:9.5pt;color:#4b5563;}' +
      '.summary-message{font-size:10.5pt;line-height:1.5;margin:4px 0 8px;color:#374151;}' +
      '.summary-tests{margin:4px 0 8px;}' +
      '.summary-tests-heading{font-size:10.5pt;font-weight:600;color:#004080;margin-bottom:4px;}' +
      '.summary-tests ul{list-style:none;margin:0;padding:0;}' +
      '.summary-tests li{display:flex;justify-content:space-between;align-items:center;font-size:9.5pt;border-bottom:1px solid #e5e7eb;padding:4px 0;}' +
      '.summary-tests li:last-child{border-bottom:none;}' +
      '.test-line-main{display:flex;gap:8px;align-items:baseline;}' +
      '.test-name{font-weight:500;color:#111827;}' +
      '.test-mae{font-size:9.5pt;color:#374151;}' +
      '.test-line-status{font-size:9pt;}' +
      '.summary-badge{display:inline-block;padding:2px 8px;border-radius:999px;font-size:9pt;font-weight:600;}' +
      '.badge-good{background:#def7ec;color:#03543f;}' +
      '.badge-neutral{background:#e5e7eb;color:#374151;}' +
      '.badge-focus{background:#fde8e8;color:#9b1c1c;}' +
      '.summary-tests-note{font-size:9pt;color:#6b7280;margin-top:4px;}' +
      '.summary-text{font-size:10pt;line-height:1.5;color:#374151;margin-top:6px;}' +
      '.summary-text p{margin:3px 0;}' +
      'section,fieldset,.card{border:1px solid #d1d5db;border-radius:10px;padding:12px 14px;margin:8px 0;background:#f9fafb;}' +
      'h2{font-size:12.5pt;margin:0 0 6px;color:#004080;}' +
      'table{width:100%;border-collapse:collapse;margin-top:4px;font-size:9.5pt;}' +
      'th,td{border:1px solid #e5e7eb;padding:5px 6px;text-align:left;vertical-align:top;}' +
      'th{background:#d9e8ff;color:#102a43;font-weight:600;}' +
      '.inputs-table th{width:38%;}' +
      '#report-inputs{break-before:page !important;page-break-before:always !important;}' +

      '#results{break-before:page;page-break-before:always;break-inside:avoid;page-break-inside:avoid;}' +
      '#results table{break-inside:avoid;page-break-inside:avoid;}' +
      '#results h2,#results #who{break-after:avoid-page;page-break-after:avoid;}' +
      '</style>';

    var header = ''
      + '<div class="report-header">'
      +   '<div class="report-logo">'
      +     (logoSrc ? '<img src="'+esc(logoSrc)+'" alt="'+esc(logoAlt)+'">' : '')
      +   '</div>'
      +   '<div class="report-title-block">'
      +     '<h1 class="report-title">HEALTHSPAN Mobility Age Report<sup>‚Ñ¢</sup></h1>'
      +   '</div>'
      + '</div>'
      + '<div class="report-intro-block">'
+   '<p class="report-intro">SENS Wellness is CCPHP‚Äôs personalized wellness and longevity program, designed to support your health and wellbeing by testing and using your personal fitness and mobility metrics in conjunction with expert health coaching to include holistic lifestyle factors of sleep, nutrition, and stress management. Our added dimension takes your specific data to a new level: longevity coaching built around a patent-pending mobility assessment called the Healthspan Mobility Index (HSMI)<sup>‚Ñ¢</sup>.</p>'
+ '</div>';

    return '<!doctype html><html><head><meta charset="utf-8">'+css+'</head><body>'+header+frag.innerHTML+'</body></html>';
  }

  // ---- Print via hidden iframe (single, robust) ----
  function iframePrint(){
    if (window.__PRINT_LOCK__) return;
    window.__PRINT_LOCK__ = true; setTimeout(function(){ window.__PRINT_LOCK__ = false; }, 2500);

    var sandbox = document.getElementById('print-sandbox');
    if (!sandbox){ injectPrintUI(); sandbox = document.getElementById('print-sandbox'); }
    var doc = sandbox && (sandbox.contentDocument || (sandbox.contentWindow && sandbox.contentWindow.document));
    if (!doc){ alert('Print sandbox not available'); return; }

    var html = buildPrintableHTML();
    doc.open(); doc.write(html); doc.close();

    setTimeout(function(){
      try{ if (sandbox.contentWindow){ sandbox.contentWindow.focus(); sandbox.contentWindow.print(); } }catch(e){}
    }, 220);
  }

 // ---- Hide legacy print buttons (keep only our reliable one) ----
function hideLegacyPrintButtons(){
  var nodes = document.querySelectorAll('button, a, [role="button"]');
  nodes.forEach(function(el){
    if (el.id === 'print-reliable-btn') return; // keep the good one
    var text = (el.textContent||'').trim().toLowerCase();
    var id   = (el.id||'').toLowerCase();
    var on   = (el.getAttribute('onclick')||'').toLowerCase();
    // catch header "Print"/"Print report" buttons & inline JS prints
    if (text === 'print' || text === 'print report' ||
        /(^|[-_])print($|[-_])/.test(id) ||
        /window\.print|iframeprint|print\(/.test(on)) {
      el.style.display = 'none';
      el.setAttribute('aria-hidden','true');
    }
  });
}

// ---- Wire up ----
injectPrintUI();
hideLegacyPrintButtons();

var btn = document.getElementById('print-reliable-btn');
if (btn) btn.addEventListener('click', function(e){
  e.preventDefault(); e.stopPropagation(); iframePrint();
}, {capture:true});

  window.addEventListener('keydown', function(e){
    if (e.altKey && (e.key==='P' || e.key==='p')){ e.preventDefault(); e.stopImmediatePropagation(); iframePrint(); }
  }, {capture:true});
})();
</script>

<style id="print-results-pagebreak-override">
@media print {
  /* Ensure Results starts at top of a fresh page */
  #results{
    break-before: page !important;
    page-break-before: always !important;
  }
  /* Keep the Results title/member line together with the start of the table */
  #results > h2,
  #results > #who{
    break-after: avoid-page !important;
    page-break-after: avoid !important;
  }
}
</style>

</body>
</html>